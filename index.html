<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英语学习平台 | English Learning</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="achievement-cards.css">
</head>
<body>
    <svg style="position: absolute; width: 0; height: 0;">
        <defs>
            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#3b82f6" />
                <stop offset="50%" stop-color="#8b5cf6" />
                <stop offset="100%" stop-color="#06b6d4" />
            </linearGradient>
        </defs>
    </svg>
    <button class="mobile-menu-btn" id="mobile-menu-btn">☰</button>
    <button class="sidebar-expand-btn" id="sidebar-expand-btn" title="展开边栏">
        <span class="toggle-icon">▶</span>
    </button>
    <div class="theme-toggle-container">
        <div class="theme-rope" id="theme-rope">
            <div class="rope-line"></div>
            <div class="rope-handle" id="theme-handle">
                <span class="handle-icon">🌙</span>
            </div>
        </div>
    </div>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo" id="sidebar-logo">
                    <span class="logo-icon">📚</span>
                    <span class="logo-text">English Learning</span>
                </div>
                <button class="sidebar-toggle" id="sidebar-toggle" title="收起边栏">
                    <span class="toggle-icon">◀</span>
                </button>
            </div>
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" data-page="home">
                            <span class="nav-icon">🏠</span>
                            <span class="nav-text">首页</span>
                        </a>
                    </li>
                    <li class="nav-divider"></li>
                    <li class="nav-category">单词学习</li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="word-recite">
                            <span class="nav-icon">📖</span>
                            <span class="nav-text">单词背诵</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="word-notebook">
                            <span class="nav-icon">📓</span>
                            <span class="nav-text">生词本</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="word-review">
                            <span class="nav-icon">📝</span>
                            <span class="nav-text">复习系统</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="word-search">
                            <span class="nav-icon">🔍</span>
                            <span class="nav-text">单词搜索</span>
                        </a>
                    </li>
                    <li class="nav-divider"></li>
                    <li class="nav-category">音频专区</li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="audio-listening">
                            <span class="nav-icon">🎧</span>
                            <span class="nav-text">听力专区</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="audio-speaking">
                            <span class="nav-icon">🎤</span>
                            <span class="nav-text">口语专区</span>
                        </a>
                    </li>
                    <li class="nav-divider"></li>
                    <li class="nav-category">趣味英语</li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="memory-cards">
                            <span class="nav-icon">🎴</span>
                            <span class="nav-text">记忆卡片</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="word-dungeon">
                            <span class="nav-icon">⚔️</span>
                            <span class="nav-text">单词地下城</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="typing-game">
                            <span class="nav-icon">⌨️</span>
                            <span class="nav-text">打字游戏</span>
                        </a>
                    </li>
                    <li class="nav-divider"></li>
                    <li class="nav-category">扩展专区</li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="proverbs">
                            <span class="nav-icon">📜</span>
                            <span class="nav-text">俗语谚语</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="phrases">
                            <span class="nav-icon">📝</span>
                            <span class="nav-text">短语学习</span>
                        </a>
                    </li>
                    <li class="nav-divider"></li>
                    <li class="nav-category">奖励中心</li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="achievements">
                            <span class="nav-icon">🏆</span>
                            <span class="nav-text">成就中心</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="gacha">
                            <span class="nav-icon">🎰</span>
                            <span class="nav-text">积分抽卡</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <div class="score-display">
                    <span class="score-icon">💰</span>
                    <span class="score-text" id="score-display">0</span>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-container">
                <div id="page-home" class="page active">
                    <div class="home-hero">
                        <div class="hero-badge">✨ 智能英语学习平台</div>
                        <h1 class="hero-title">English Learning</h1>
                        <p class="hero-subtitle">掌握3500核心词汇，开启英语学习新旅程</p>
                        <div class="hero-actions">
                            <button class="hero-btn primary" data-action="recite">开始学习</button>
                            <button class="hero-btn secondary" data-action="review">复习巩固</button>
                        </div>
                    </div>

                    <div class="home-stats">
                        <div class="stat-card">
                            <div class="stat-icon">📚</div>
                            <div class="stat-info">
                                <div class="stat-value" id="total-words">3500</div>
                                <div class="stat-label">核心词汇</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">✅</div>
                            <div class="stat-info">
                                <div class="stat-value" id="learned-words">0</div>
                                <div class="stat-label">已学习</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🔥</div>
                            <div class="stat-info">
                                <div class="stat-value" id="streak-days">0</div>
                                <div class="stat-label">连续天数</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🏆</div>
                            <div class="stat-info">
                                <div class="stat-value" id="achievements-count">0</div>
                                <div class="stat-label">成就解锁</div>
                            </div>
                        </div>
                    </div>

                    <div class="home-section">
                        <h2 class="section-title">快速开始</h2>
                        <div class="quick-grid">
                            <div class="quick-card" data-action="recite">
                                <div class="quick-icon">📖</div>
                                <div class="quick-content">
                                    <h3>单词背诵</h3>
                                    <p>系统化记忆新单词</p>
                                </div>
                                <div class="quick-arrow">→</div>
                            </div>
                            <div class="quick-card" data-action="review">
                                <div class="quick-icon">📝</div>
                                <div class="quick-content">
                                    <h3>复习系统</h3>
                                    <p>巩固已学单词</p>
                                </div>
                                <div class="quick-arrow">→</div>
                            </div>
                            <div class="quick-card" data-action="memory">
                                <div class="quick-icon">🎴</div>
                                <div class="quick-content">
                                    <h3>记忆卡片</h3>
                                    <p>趣味记忆挑战</p>
                                </div>
                                <div class="quick-arrow">→</div>
                            </div>
                            <div class="quick-card" data-action="dungeon">
                                <div class="quick-icon">⚔️</div>
                                <div class="quick-content">
                                    <h3>单词地下城</h3>
                                    <p>游戏化学习</p>
                                </div>
                                <div class="quick-arrow">→</div>
                            </div>
                        </div>
                    </div>

                    <div class="home-section">
                        <h2 class="section-title">更多功能</h2>
                        <div class="feature-grid">
                            <div class="feature-card" data-action="typing">
                                <div class="feature-icon">⌨️</div>
                                <h3>打字游戏</h3>
                                <p>练习拼写速度</p>
                            </div>
                            <div class="feature-card" data-action="gacha">
                                <div class="feature-icon">🎰</div>
                                <h3>积分抽卡</h3>
                                <p>收集单词卡片</p>
                            </div>
                            <div class="feature-card" data-action="listening">
                                <div class="feature-icon">🎧</div>
                                <h3>听力专区</h3>
                                <p>提升听力能力</p>
                            </div>
                            <div class="feature-card" data-action="proverbs">
                                <div class="feature-icon">📜</div>
                                <h3>俗语谚语</h3>
                                <p>地道英语表达</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-word-recite" class="page">
                    <div class="recite-header-premium">
                        <div class="recite-header-left">
                            <h1 class="recite-title-premium">单词背诵</h1>
                            <p class="recite-subtitle-premium">高效记忆，轻松掌握</p>
                        </div>
                        <div class="recite-header-stats">
                            <div class="stat-pill">
                                <span class="pill-icon">📚</span>
                                <span class="pill-value" id="recite-learned">0</span>
                                <span class="pill-label">已学习</span>
                            </div>
                            <div class="stat-pill">
                                <span class="pill-icon">✅</span>
                                <span class="pill-value" id="recite-mastered">0</span>
                                <span class="pill-label">已掌握</span>
                            </div>
                            <div class="stat-pill">
                                <span class="pill-icon">🔥</span>
                                <span class="pill-value" id="recite-streak">0</span>
                                <span class="pill-label">连续</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recite-daily-goal">
                        <div class="daily-goal-left">
                            <span class="goal-icon">🎯</span>
                            <span class="goal-text">今日目标</span>
                            <span class="goal-progress"><span id="daily-learned">0</span> / <span id="daily-goal">50</span></span>
                        </div>
                        <div class="daily-goal-bar">
                            <div class="daily-goal-fill" id="daily-goal-fill"></div>
                        </div>
                        <button class="goal-setting-btn" id="goal-setting-btn" title="设置目标">⚙️</button>
                    </div>
                    
                    <div class="recite-toolbar">
                        <div class="mode-tabs">
                            <button class="mode-tab active" data-mode="order">顺序</button>
                            <button class="mode-tab" data-mode="random">随机</button>
                            <button class="mode-tab" data-mode="letter">字母</button>
                            <button class="mode-tab" data-mode="notebook">生词</button>
                        </div>
                        <div class="letter-picker" id="letter-picker" style="display: none;">
                            <div class="letter-grid" id="letter-grid"></div>
                        </div>
                        <div class="toolbar-actions">
                            <button class="toolbar-btn" id="auto-speak-btn" title="自动发音">
                                <span class="btn-icon">🔊</span>
                            </button>
                            <button class="toolbar-btn" id="recite-settings-btn" title="设置">
                                <span class="btn-icon">⚙️</span>
                            </button>
                            <button class="reset-btn" id="recite-reset" title="重置进度">
                                <span>🔄</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="recite-progress-premium">
                        <div class="progress-info">
                            <span class="progress-current"><span id="recite-current">1</span> / <span id="recite-total">3500</span></span>
                            <span class="progress-percent" id="recite-percentage">0%</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-bar-premium" id="recite-progress-fill"></div>
                        </div>
                    </div>
                    
                    <div class="recite-card-wrapper" id="recite-card-container">
                        <div class="recite-card-premium" id="recite-card">
                            <div class="card-front-premium">
                                <div class="card-top">
                                    <span class="word-badge" id="recite-word-number">#0001</span>
                                    <div class="card-top-actions">
                                        <button class="favorite-btn" id="recite-favorite-btn" title="收藏到生词本">♡</button>
                                        <button class="sound-btn" id="recite-audio-btn">🔊</button>
                                    </div>
                                </div>
                                <div class="card-main">
                                    <div class="word-main" id="recite-word">abandon</div>
                                    <div class="word-phonetic-premium" id="recite-phonetic">/əˈbændən/</div>
                                </div>
                                <button class="reveal-btn" id="recite-show-btn">
                                    <span>显示释义</span>
                                    <span class="hint-key">Space</span>
                                </button>
                            </div>
                            <div class="card-back-premium">
                                <div class="card-top">
                                    <span class="word-badge" id="recite-word-number-back">#0001</span>
                                    <div class="card-top-actions">
                                        <button class="favorite-btn" id="recite-favorite-btn-back" title="收藏到生词本">♡</button>
                                        <button class="sound-btn" id="recite-audio-btn-back">🔊</button>
                                    </div>
                                </div>
                                <div class="card-main-back">
                                    <div class="word-back" id="recite-word-back">abandon</div>
                                    <div class="phonetic-back" id="recite-phonetic-back">/əˈbændən/</div>
                                </div>
                                <div class="meaning-block">
                                    <div class="block-label">释义</div>
                                    <div class="block-content" id="recite-meaning">v. 抛弃，放弃</div>
                                </div>
                                <div class="example-block">
                                    <div class="block-label">例句</div>
                                    <div class="block-content" id="recite-example">He abandoned his family.</div>
                                </div>
                                <button class="hide-btn" id="recite-hide-btn">
                                    <span>◀ 收起释义</span>
                                    <span class="hint-key">Space</span>
                                </button>
                                <div class="action-buttons">
                                    <button class="action-btn-premium btn-unknown" id="recite-unknown-btn">
                                        <span class="btn-emoji">❌</span>
                                        <span class="btn-label">不认识</span>
                                        <span class="btn-key">A</span>
                                    </button>
                                    <button class="action-btn-premium btn-hard" id="recite-hard-btn">
                                        <span class="btn-emoji">🤔</span>
                                        <span class="btn-label">有点难</span>
                                        <span class="btn-key">S</span>
                                    </button>
                                    <button class="action-btn-premium btn-known" id="recite-know-btn">
                                        <span class="btn-emoji">✅</span>
                                        <span class="btn-label">已掌握</span>
                                        <span class="btn-key">D</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recite-hints">
                        <span><kbd>Space</kbd> 显示释义</span>
                        <span><kbd>A</kbd> 不认识</span>
                        <span><kbd>S</kbd> 有点难</span>
                        <span><kbd>D</kbd> 已掌握</span>
                        <span><kbd>F</kbd> 收藏</span>
                    </div>
                    
                    <div class="recite-stats-panel" id="recite-stats-panel">
                        <div class="stats-panel-header">
                            <h3>📊 学习统计</h3>
                            <button class="close-panel-btn" id="close-stats-panel">✕</button>
                        </div>
                        <div class="stats-panel-content">
                            <div class="stats-chart">
                                <div class="chart-title">本周学习</div>
                                <div class="chart-bars" id="weekly-chart">
                                    <div class="chart-bar" data-day="一"><div class="bar-fill" style="height: 60%"></div></div>
                                    <div class="chart-bar" data-day="二"><div class="bar-fill" style="height: 40%"></div></div>
                                    <div class="chart-bar" data-day="三"><div class="bar-fill" style="height: 80%"></div></div>
                                    <div class="chart-bar" data-day="四"><div class="bar-fill" style="height: 50%"></div></div>
                                    <div class="chart-bar" data-day="五"><div class="bar-fill" style="height: 70%"></div></div>
                                    <div class="chart-bar" data-day="六"><div class="bar-fill" style="height: 30%"></div></div>
                                    <div class="chart-bar active" data-day="日"><div class="bar-fill" style="height: 90%"></div></div>
                                </div>
                            </div>
                            <div class="stats-details">
                                <div class="stat-item">
                                    <span class="stat-label">总学习天数</span>
                                    <span class="stat-value" id="total-days">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">平均每日</span>
                                    <span class="stat-value" id="avg-daily">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">最长连续</span>
                                    <span class="stat-value" id="max-streak">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recite-settings-modal" id="recite-settings-modal">
                        <div class="settings-modal-content">
                            <div class="settings-header">
                                <h3>⚙️ 背诵设置</h3>
                                <button class="close-modal-btn" id="close-settings-modal">✕</button>
                            </div>
                            <div class="settings-body">
                                <div class="setting-item">
                                    <label>每日目标</label>
                                    <div class="setting-input">
                                        <input type="number" id="setting-daily-goal" min="10" max="500" value="50">
                                        <span>个单词</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>学习模式</label>
                                    <div class="setting-options">
                                        <button class="setting-option active" data-mode="en-zh">英译汉</button>
                                        <button class="setting-option" data-mode="zh-en">汉译英</button>
                                        <button class="setting-option" data-mode="mixed">混合</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>自动发音</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="setting-auto-speak">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <label>显示例句</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="setting-show-example" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <label>显示音标</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="setting-show-phonetic" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="settings-footer">
                                <button class="save-settings-btn" id="save-settings-btn">保存设置</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 罗小黑彩蛋弹窗 -->
                <div class="easter-egg-modal" id="luoxiaohei-modal">
                    <div class="easter-egg-content">
                        <button class="easter-egg-close" id="close-luoxiaohei">✕</button>
                        <div class="easter-egg-title">🐱 你发现了罗小黑！</div>
                        <div class="easter-egg-gif">
                            <img src="彩蛋/罗小黑/20200402130159_gprlx.gif" alt="罗小黑">
                        </div>
                        <div class="easter-egg-message">罗小黑说：继续加油学习哦！</div>
                    </div>
                </div>

                <div id="page-word-notebook" class="page">
                    <div class="notebook-header-premium">
                        <div class="notebook-header-left">
                            <h1 class="notebook-title-premium">生词本</h1>
                            <p class="notebook-subtitle-premium">记录你的学习历程</p>
                        </div>
                        <div class="notebook-header-actions">
                            <span class="notebook-count"><span id="notebook-count">0</span> 个生词</span>
                            <button class="export-btn-premium" id="export-notebook">📤 导出</button>
                            <button class="import-btn-premium" id="import-notebook">📥 导入</button>
                        </div>
                    </div>
                    
                    <div class="notebook-stats-bar">
                        <div class="notebook-stat">
                            <span class="stat-icon">📖</span>
                            <span class="stat-info">
                                <span class="stat-num" id="notebook-new-count">0</span>
                                <span class="stat-label">新词</span>
                            </span>
                        </div>
                        <div class="notebook-stat">
                            <span class="stat-icon">🔄</span>
                            <span class="stat-info">
                                <span class="stat-num" id="notebook-learning-count">0</span>
                                <span class="stat-label">学习中</span>
                            </span>
                        </div>
                        <div class="notebook-stat">
                            <span class="stat-icon">✅</span>
                            <span class="stat-info">
                                <span class="stat-num" id="notebook-mastered-count">0</span>
                                <span class="stat-label">已掌握</span>
                            </span>
                        </div>
                        <div class="notebook-stat">
                            <span class="stat-icon">📊</span>
                            <span class="stat-info">
                                <span class="stat-num" id="notebook-mastery-rate">0%</span>
                                <span class="stat-label">掌握率</span>
                            </span>
                        </div>
                    </div>
                    
                    <div class="notebook-toolbar">
                        <div class="notebook-search">
                            <input type="text" class="notebook-search-input" id="notebook-search" placeholder="搜索单词...">
                        </div>
                        <div class="notebook-filters">
                            <button class="filter-btn active" data-filter="all">全部</button>
                            <button class="filter-btn" data-filter="new">新词</button>
                            <button class="filter-btn" data-filter="learning">学习中</button>
                            <button class="filter-btn" data-filter="mastered">已掌握</button>
                        </div>
                        <div class="notebook-actions">
                            <button class="action-btn" id="select-all-btn">全选</button>
                            <button class="action-btn danger" id="delete-selected-btn" style="display: none;">删除选中</button>
                            <button class="action-btn" id="mark-mastered-btn" style="display: none;">标记已掌握</button>
                        </div>
                        <div class="letter-filter-notebook" id="notebook-letter-filter"></div>
                    </div>
                    
                    <div class="notebook-content">
                        <div class="notebook-grid" id="notebook-list"></div>
                        <div class="notebook-empty" id="notebook-empty">
                            <div class="empty-icon">📝</div>
                            <p>生词本还是空的</p>
                            <p class="empty-hint">在背诵过程中标记"学习中"的单词会出现在这里</p>
                        </div>
                    </div>
                    
                    <div class="notebook-batch-actions" id="notebook-batch-actions" style="display: none;">
                        <span class="selected-count">已选择 <span id="selected-count">0</span> 个单词</span>
                        <button class="batch-btn danger" id="batch-delete">🗑️ 删除</button>
                        <button class="batch-btn" id="batch-mastered">✅ 标记已掌握</button>
                        <button class="batch-btn" id="batch-export">📤 导出选中</button>
                        <button class="batch-btn cancel" id="batch-cancel">取消选择</button>
                    </div>
                </div>

                <div id="page-word-review" class="page">
                    <div class="review-header-premium">
                        <div class="review-header-left">
                            <h1 class="review-title-premium">复习系统</h1>
                            <p class="review-subtitle-premium">巩固记忆，查漏补缺</p>
                        </div>
                        <div class="review-stats-premium">
                            <div class="review-stat correct">
                                <span class="stat-num" id="review-correct">0</span>
                                <span class="stat-label">正确</span>
                            </div>
                            <div class="review-stat wrong">
                                <span class="stat-num" id="review-wrong">0</span>
                                <span class="stat-label">错误</span>
                            </div>
                            <div class="review-stat streak">
                                <span class="stat-num" id="review-streak">0</span>
                                <span class="stat-label">连对</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-toolbar">
                        <div class="review-mode-tabs">
                            <button class="review-mode-tab active" data-mode="choice">选择题</button>
                            <button class="review-mode-tab" data-mode="spell">拼写</button>
                            <button class="review-mode-tab" data-mode="listen">听写</button>
                        </div>
                        <div class="review-source-tabs">
                            <button class="source-tab active" data-source="all">全部单词</button>
                            <button class="source-tab" data-source="notebook">生词本</button>
                            <button class="source-tab" data-source="wrong">错题本</button>
                        </div>
                    </div>
                    
                    <div class="review-progress-premium">
                        <span class="review-progress-text"><span id="review-current">1</span> / <span id="review-total">20</span></span>
                        <div class="review-progress-track">
                            <div class="review-progress-bar" id="review-progress-bar"></div>
                        </div>
                    </div>
                    
                    <div class="review-card-premium" id="review-card">
                        <div class="review-word-premium" id="review-word"></div>
                        <div class="review-phonetic-premium" id="review-phonetic"></div>
                        <div class="review-options-premium" id="review-options"></div>
                        <div class="review-spell-area" id="review-spell-area" style="display: none;">
                            <input type="text" class="spell-input" id="spell-input" placeholder="输入单词...">
                            <button class="spell-submit" id="spell-submit">确认</button>
                        </div>
                        <div class="review-result-premium" id="review-result"></div>
                        <button class="review-next-btn" id="review-next-btn" style="display: none;">
                            <span>下一个</span>
                            <span class="hint-key">Enter</span>
                        </button>
                    </div>
                    
                    <div class="review-hints">
                        <span><kbd>1-4</kbd> 选择答案</span>
                        <span><kbd>Enter</kbd> 确认</span>
                    </div>
                </div>

                <div id="page-word-search" class="page">
                    <div class="search-page-header">
                        <h1 class="search-page-title">🔍 单词搜索</h1>
                        <p class="search-page-subtitle">快速查找你想要的单词</p>
                    </div>
                    <div class="search-container">
                        <div class="search-input-section">
                            <div class="search-input-wrapper">
                                <span class="search-icon">🔍</span>
                                <input type="text" class="search-input-premium" id="search-input" placeholder="输入单词或中文释义搜索...">
                                <button class="search-clear-btn" id="search-clear-btn">✕</button>
                            </div>
                            <button class="search-btn-premium" id="search-btn">
                                <span class="btn-icon">🔍</span>
                                <span class="btn-text">搜索</span>
                            </button>
                        </div>
                        
                        <div class="search-filter-section">
                            <div class="filter-title">
                                <span class="filter-icon">🔤</span>
                                <span>按首字母筛选</span>
                            </div>
                            <div class="alphabet-filter-premium" id="alphabet-filter"></div>
                        </div>
                        
                        <div class="search-results-section">
                            <div class="results-header">
                                <span class="results-count">找到 <span id="search-results-count">0</span> 个结果</span>
                                <div class="results-sort">
                                    <label>排序:</label>
                                    <select id="search-sort" class="sort-select">
                                        <option value="default">默认</option>
                                        <option value="asc">A-Z</option>
                                        <option value="desc">Z-A</option>
                                    </select>
                                </div>
                            </div>
                            <div class="search-results-grid" id="search-results"></div>
                            <div class="search-pagination" id="search-pagination"></div>
                        </div>
                    </div>
                </div>

                <div id="page-audio-listening" class="page">
                    <div class="audio-header-premium">
                        <div class="audio-header-left">
                            <h1 class="audio-title-premium">听力专区</h1>
                            <p class="audio-subtitle-premium">提升英语听力能力</p>
                        </div>
                        <div class="audio-header-stats">
                            <div class="audio-stat">
                                <span class="audio-stat-icon">🎧</span>
                                <span class="audio-stat-value" id="listening-count">0</span>
                                <span class="audio-stat-label">个音频</span>
                            </div>
                            <div class="audio-stat">
                                <span class="audio-stat-icon">✅</span>
                                <span class="audio-stat-value" id="listening-played">0</span>
                                <span class="audio-stat-label">已播放</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="audio-toolbar">
                        <div class="audio-search">
                            <input type="text" class="audio-search-input" id="listening-search" placeholder="搜索音频...">
                        </div>
                    </div>
                    
                    <div class="audio-player-premium" id="listening-player" style="display: none;">
                        <div class="player-info">
                            <span class="player-title" id="listening-player-title">未选择音频</span>
                        </div>
                        <div class="player-controls">
                            <button class="player-btn" id="listening-prev-btn">⏮</button>
                            <button class="player-btn play-btn" id="listening-play-btn">▶</button>
                            <button class="player-btn" id="listening-next-btn">⏭</button>
                            <button class="player-btn loop-btn" id="listening-loop-btn" title="循环">🔁</button>
                        </div>
                        <div class="player-progress">
                            <span class="player-time" id="listening-current-time">0:00</span>
                            <input type="range" class="progress-slider" id="listening-progress-slider" min="0" max="100" value="0">
                            <span class="player-time" id="listening-duration">0:00</span>
                        </div>
                        <div class="player-extra-controls">
                            <div class="player-speed">
                                <label>倍速:</label>
                                <select id="listening-speed" class="speed-select">
                                    <option value="0.5">0.5x</option>
                                    <option value="0.75">0.75x</option>
                                    <option value="1" selected>1x</option>
                                    <option value="1.25">1.25x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="2">2x</option>
                                </select>
                            </div>
                            <div class="player-volume">
                                <span>🔊</span>
                                <input type="range" class="volume-slider" id="listening-volume" min="0" max="100" value="80">
                            </div>
                        </div>
                    </div>
                    
                    <div class="audio-content-wrapper">
                        <div class="audio-list-section">
                            <h3 class="audio-list-title">音频列表</h3>
                            <div class="audio-grid-premium" id="audio-list"></div>
                        </div>
                        <div class="playlist-section">
                            <h3 class="playlist-title">播放列表 <span id="listening-playlist-count">(0)</span></h3>
                            <div class="playlist-container" id="listening-playlist"></div>
                        </div>
                    </div>
                </div>

                <div id="page-audio-speaking" class="page">
                    <div class="audio-header-premium">
                        <div class="audio-header-left">
                            <h1 class="audio-title-premium">口语专区</h1>
                            <p class="audio-subtitle-premium">练习英语口语表达</p>
                        </div>
                        <div class="audio-header-stats">
                            <div class="audio-stat">
                                <span class="audio-stat-icon">🎤</span>
                                <span class="audio-stat-value" id="speaking-count">0</span>
                                <span class="audio-stat-label">个音频</span>
                            </div>
                            <div class="audio-stat">
                                <span class="audio-stat-icon">✅</span>
                                <span class="audio-stat-value" id="speaking-played">0</span>
                                <span class="audio-stat-label">已播放</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="audio-toolbar">
                        <div class="audio-search">
                            <input type="text" class="audio-search-input" id="speaking-search" placeholder="搜索音频...">
                        </div>
                    </div>
                    
                    <div class="audio-player-premium" id="speaking-player" style="display: none;">
                        <div class="player-info">
                            <span class="player-title" id="speaking-player-title">未选择音频</span>
                        </div>
                        <div class="player-controls">
                            <button class="player-btn" id="speaking-prev-btn">⏮</button>
                            <button class="player-btn play-btn" id="speaking-play-btn">▶</button>
                            <button class="player-btn" id="speaking-next-btn">⏭</button>
                            <button class="player-btn loop-btn" id="speaking-loop-btn" title="循环">🔁</button>
                        </div>
                        <div class="player-progress">
                            <span class="player-time" id="speaking-current-time">0:00</span>
                            <input type="range" class="progress-slider" id="speaking-progress-slider" min="0" max="100" value="0">
                            <span class="player-time" id="speaking-duration">0:00</span>
                        </div>
                        <div class="player-extra-controls">
                            <div class="player-speed">
                                <label>倍速:</label>
                                <select id="speaking-speed" class="speed-select">
                                    <option value="0.5">0.5x</option>
                                    <option value="0.75">0.75x</option>
                                    <option value="1" selected>1x</option>
                                    <option value="1.25">1.25x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="2">2x</option>
                                </select>
                            </div>
                            <div class="player-volume">
                                <span>🔊</span>
                                <input type="range" class="volume-slider" id="speaking-volume" min="0" max="100" value="80">
                            </div>
                        </div>
                    </div>
                    
                    <div class="audio-content-wrapper">
                        <div class="audio-list-section">
                            <h3 class="audio-list-title">音频列表</h3>
                            <div class="audio-grid-premium" id="speaking-list"></div>
                        </div>
                        <div class="playlist-section">
                            <h3 class="playlist-title">播放列表 <span id="speaking-playlist-count">(0)</span></h3>
                            <div class="playlist-container" id="speaking-playlist"></div>
                        </div>
                    </div>
                </div>

                <div id="page-memory-cards" class="page">
                    <div class="memory-header-premium">
                        <div class="memory-header-left">
                            <h1 class="memory-title-premium">记忆卡片</h1>
                            <p class="memory-subtitle-premium">翻牌配对，训练记忆</p>
                        </div>
                        <div class="memory-header-stats">
                            <div class="memory-stat">
                                <span class="memory-stat-icon">🏆</span>
                                <span class="memory-stat-value" id="memory-best-time">--</span>
                                <span class="memory-stat-label">最佳时间</span>
                            </div>
                            <div class="memory-stat">
                                <span class="memory-stat-icon">🎮</span>
                                <span class="memory-stat-value" id="memory-games">0</span>
                                <span class="memory-stat-label">游戏次数</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="memory-toolbar">
                        <div class="memory-difficulty-tabs">
                            <button class="difficulty-tab active" data-difficulty="easy">简单 4×4</button>
                            <button class="difficulty-tab" data-difficulty="medium">中等 6×6</button>
                            <button class="difficulty-tab" data-difficulty="hard">困难 8×8</button>
                        </div>
                        <button class="memory-start-btn" id="start-memory-btn">
                            <span>开始游戏</span>
                        </button>
                    </div>
                    
                    <div class="memory-game-area" id="memory-game-area" style="display: none;">
                        <div class="memory-game-stats">
                            <div class="game-stat">
                                <span class="game-stat-icon">⏱️</span>
                                <span class="game-stat-value" id="memory-time">0</span>
                                <span class="game-stat-label">秒</span>
                            </div>
                            <div class="game-stat">
                                <span class="game-stat-icon">👆</span>
                                <span class="game-stat-value" id="memory-moves">0</span>
                                <span class="game-stat-label">步</span>
                            </div>
                            <div class="game-stat">
                                <span class="game-stat-icon">✅</span>
                                <span class="game-stat-value" id="memory-pairs">0</span>
                                <span class="game-stat-label">配对</span>
                            </div>
                        </div>
                        <div class="memory-grid-premium" id="memory-grid"></div>
                    </div>
                    
                    <div class="memory-start-screen" id="memory-start-screen">
                        <div class="memory-start-content">
                            <div class="start-icon">🃏</div>
                            <h2>准备好了吗？</h2>
                            <p>翻开卡片，找到相同的单词配对</p>
                            <p class="start-hint">选择难度后点击"开始游戏"</p>
                        </div>
                    </div>
                </div>

                <div id="page-word-dungeon" class="page">
                    <div class="dungeon-header-premium">
                        <div class="dungeon-header-left">
                            <h1 class="dungeon-title-premium">单词地下城</h1>
                            <p class="dungeon-subtitle-premium">用你的卡牌征服地下城</p>
                        </div>
                        <div class="dungeon-header-stats">
                            <div class="dungeon-stat">
                                <span class="dungeon-stat-icon">🏰</span>
                                <span class="dungeon-stat-value" id="dungeon-floor">1</span>
                                <span class="dungeon-stat-label">层</span>
                            </div>
                            <div class="dungeon-stat">
                                <span class="dungeon-stat-icon">⚔️</span>
                                <span class="dungeon-stat-value" id="dungeon-kills">0</span>
                                <span class="dungeon-stat-label">击杀</span>
                            </div>
                            <div class="dungeon-stat">
                                <span class="dungeon-stat-icon">🃏</span>
                                <span class="dungeon-stat-value" id="dungeon-cards">0</span>
                                <span class="dungeon-stat-label">卡牌</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dungeon-container-premium" id="dungeon-container">
                        <div class="dungeon-start-premium" id="dungeon-start">
                            <div class="start-content">
                                <h2>选择你的职业</h2>
                                <p class="start-desc">每个职业有独特的技能和属性加成</p>
                                <div class="class-selection-premium" id="class-selection-grid"></div>
                                
                                <h2 style="margin-top: 32px;">选择你的卡组</h2>
                                <p class="start-desc">使用收藏卡组可让你抽到的卡牌发挥作用</p>
                                <div class="deck-selection-container" id="deck-selection"></div>
                                
                                <button class="start-dungeon-btn" id="start-dungeon-btn">开始冒险</button>
                            </div>
                        </div>
                        
                        <div class="dungeon-game-premium" id="dungeon-game" style="display: none;">
                            <div class="dungeon-battle-premium">
                                <div class="player-section">
                                    <div class="player-avatar-premium" id="player-avatar">⚔️</div>
                                    <div class="player-hp-section">
                                        <div class="hp-bar-premium">
                                            <div class="hp-fill-premium player-hp-fill" id="player-hp-fill"></div>
                                        </div>
                                        <span class="hp-text">HP: <span id="player-hp">100</span>/<span id="player-max-hp">100</span></span>
                                    </div>
                                </div>
                                
                                <div class="battle-vs">VS</div>
                                
                                <div class="enemy-section">
                                    <div class="enemy-avatar-premium" id="enemy-avatar">👹</div>
                                    <div class="enemy-info-premium">
                                        <span class="enemy-name-premium" id="enemy-name">史莱姆</span>
                                        <div class="hp-bar-premium enemy-hp-bar">
                                            <div class="hp-fill-premium enemy-hp-fill" id="enemy-hp-fill"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dungeon-cards-section">
                                <div class="cards-header">
                                    <span>你的卡牌</span>
                                    <span class="cards-hint">点击卡牌使用</span>
                                </div>
                                <div class="dungeon-hand-premium" id="dungeon-hand"></div>
                                <div class="dungeon-actions">
                                    <button class="end-turn-btn" id="end-turn-btn">结束回合</button>
                                </div>
                            </div>
                            
                            <div class="dungeon-log-premium" id="dungeon-log"></div>
                        </div>
                        
                        <div class="dungeon-map-screen-premium" id="dungeon-map-screen" style="display: none;">
                            <div class="map-header">
                                <div class="map-header-left">
                                    <span class="map-title">地下城地图</span>
                                    <span class="map-floor-display">第 <span id="current-floor">1</span> 层</span>
                                </div>
                                <div class="map-header-right">
                                    <div class="map-player-info">
                                        <span class="map-player-hp">❤️ <span id="map-player-hp">100</span>/<span id="map-player-max-hp">100</span></span>
                                        <div class="map-hp-bar">
                                            <div class="map-hp-fill" id="map-player-hp-bar"></div>
                                        </div>
                                    </div>
                                    <div class="map-player-gold">💰 <span id="map-player-gold">0</span></div>
                                    <div class="map-player-deck">🎴 <span id="map-deck-count">0</span></div>
                                    <button class="map-menu-btn" id="map-menu-btn">☰</button>
                                </div>
                            </div>
                            <div class="map-path-container">
                                <div class="map-path" id="map-path"></div>
                            </div>
                            <div class="map-footer">
                                <span class="map-mode-display" id="current-mode-display">爬塔模式</span>
                            </div>
                        </div>
                        
                        <div class="reward-screen-premium" id="reward-screen" style="display: none;">
                            <div class="reward-container">
                                <h2>🎉 胜利！选择你的奖励</h2>
                                <div class="reward-options" id="reward-options"></div>
                                <button class="skip-reward-btn" id="skip-reward-btn">跳过</button>
                            </div>
                        </div>
                        
                        <div class="shop-screen-premium" id="shop-screen" style="display: none;">
                            <div class="shop-container">
                                <div class="shop-header">
                                    <h2>🏪 商店</h2>
                                    <div class="shop-gold-display">💰 <span id="shop-gold">0</span></div>
                                </div>
                                <div class="shop-items" id="shop-items"></div>
                                <button class="leave-shop-btn" id="leave-shop-btn">离开商店</button>
                            </div>
                        </div>
                        
                        <div class="camp-screen-premium" id="camp-screen" style="display: none;">
                            <div class="camp-container">
                                <h2>🏕️ 营地</h2>
                                <p>在这里休息恢复</p>
                                <div class="camp-actions">
                                    <button class="camp-rest-btn" id="camp-rest">休息 (恢复30%HP)</button>
                                    <button class="leave-camp-btn" id="leave-camp-btn">离开</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="special-room-premium" id="special-room" style="display: none;">
                            <div class="special-container">
                                <h2>❓ 神秘房间</h2>
                                <div class="special-content" id="special-content"></div>
                            </div>
                        </div>
                        
                        <div class="gameover-screen-premium" id="gameover-screen" style="display: none;">
                            <div class="gameover-container">
                                <h2>💀 游戏结束</h2>
                                <div class="gameover-stats">
                                    <div class="gameover-stat">到达层数: <span id="gameover-floor">1</span></div>
                                    <div class="gameover-stat">总层数: <span id="gameover-floors">1</span></div>
                                    <div class="gameover-stat">击杀数: <span id="gameover-kills">0</span></div>
                                    <div class="gameover-stat">金币获得: <span id="gameover-gold">0</span></div>
                                </div>
                                <div class="gameover-actions">
                                    <button class="gameover-retry-btn" id="gameover-retry-btn">再来一次</button>
                                    <button class="gameover-menu-btn" id="gameover-menu-btn">返回主菜单</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="victory-screen-premium" id="victory-screen" style="display: none;">
                            <div class="victory-container">
                                <h2>🏆 胜利！</h2>
                                <div class="victory-stats">
                                    <div class="victory-stat">总层数: <span id="victory-floors">20</span></div>
                                    <div class="victory-stat">击杀数: <span id="victory-kills">0</span></div>
                                    <div class="victory-stat">金币获得: <span id="victory-gold">0</span></div>
                                </div>
                                <div class="victory-actions">
                                    <button class="victory-menu-btn" id="victory-menu-btn">返回主菜单</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-typing-game" class="page">
                    <div class="typing-header-premium">
                        <div class="typing-header-left">
                            <h1 class="typing-title-premium">打字游戏</h1>
                            <p class="typing-subtitle-premium">提高打字速度和准确率</p>
                        </div>
                        <div class="typing-header-stats">
                            <div class="typing-stat">
                                <span class="typing-stat-icon">🏆</span>
                                <span class="typing-stat-value" id="typing-best-wpm">--</span>
                                <span class="typing-stat-label">最佳WPM</span>
                            </div>
                            <div class="typing-stat">
                                <span class="typing-stat-icon">🎮</span>
                                <span class="typing-stat-value" id="typing-games">0</span>
                                <span class="typing-stat-label">游戏次数</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="typing-toolbar">
                        <div class="typing-mode-tabs">
                            <button class="typing-mode-tab active" data-mode="normal">普通模式</button>
                            <button class="typing-mode-tab" data-mode="hard">困难模式</button>
                            <button class="typing-mode-tab" data-mode="zen">禅模式</button>
                        </div>
                        <button class="typing-start-btn" id="start-typing-btn">
                            <span>开始游戏</span>
                        </button>
                    </div>
                    
                    <div class="typing-game-area" id="typing-game-area" style="display: none;">
                        <div class="typing-stats-row">
                            <div class="typing-game-stat">
                                <span class="game-stat-icon">⏱️</span>
                                <span class="game-stat-value" id="typing-time">60</span>
                                <span class="game-stat-label">秒</span>
                            </div>
                            <div class="typing-game-stat">
                                <span class="game-stat-icon">📊</span>
                                <span class="game-stat-value" id="typing-score">0</span>
                                <span class="game-stat-label">分数</span>
                            </div>
                            <div class="typing-game-stat">
                                <span class="game-stat-icon">⚡</span>
                                <span class="game-stat-value" id="typing-wpm">0</span>
                                <span class="game-stat-label">WPM</span>
                            </div>
                            <div class="typing-game-stat">
                                <span class="game-stat-icon">🎯</span>
                                <span class="game-stat-value" id="typing-accuracy">100%</span>
                                <span class="game-stat-label">准确率</span>
                            </div>
                        </div>
                        
                        <div class="typing-word-display" id="typing-word-display">
                            <span class="word-remaining">word</span>
                        </div>
                        
                        <div class="typing-meaning-display" id="typing-meaning-display" style="display: none;"></div>
                        
                        <input type="text" class="typing-input-premium" id="typing-input" placeholder="输入上方显示的单词后按 Enter..." autocomplete="off">
                        
                        <div class="typing-progress">
                            <div class="typing-progress-fill" id="typing-progress-fill"></div>
                        </div>
                    </div>
                    
                    <div class="typing-start-screen" id="typing-start-screen">
                        <div class="typing-start-content">
                            <div class="start-icon">⌨️</div>
                            <h2>准备好了吗？</h2>
                            <p>快速准确地输入显示的单词</p>
                            <p class="start-hint">选择模式后点击"开始游戏"</p>
                        </div>
                    </div>
                </div>

                <div id="page-proverbs" class="page">
                    <div class="proverbs-header-premium">
                        <div class="proverbs-header-left">
                            <h1 class="proverbs-title-premium">俗语谚语</h1>
                            <p class="proverbs-subtitle-premium">英语地道表达，文化精髓</p>
                        </div>
                        <div class="proverbs-header-stats">
                            <div class="proverb-stat">
                                <span class="proverb-stat-icon">📜</span>
                                <span class="proverb-stat-value" id="proverbs-total-count">0</span>
                                <span class="proverb-stat-label">条俗语</span>
                            </div>
                            <div class="proverb-stat">
                                <span class="proverb-stat-icon">⭐</span>
                                <span class="proverb-stat-value" id="proverbs-fav-count">0</span>
                                <span class="proverb-stat-label">已收藏</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="proverbs-toolbar">
                        <div class="proverbs-tabs">
                            <button class="proverbs-tab active" data-tab="random">随机</button>
                            <button class="proverbs-tab" data-tab="all">全部</button>
                            <button class="proverbs-tab" data-tab="favorites">收藏</button>
                        </div>
                        <div class="proverbs-search">
                            <input type="text" class="proverbs-search-input" id="proverbs-search-input" placeholder="搜索俗语...">
                        </div>
                    </div>
                    
                    <div class="proverbs-content" id="proverbs-random-content">
                        <div class="proverb-card-premium" id="proverb-random-card">
                            <div class="proverb-content-premium" id="proverb-content">A friend in need is a friend indeed.</div>
                            <div class="proverb-translation-premium" id="proverb-translation">患难见真情。</div>
                            <div class="proverb-actions">
                                <button class="proverb-action-btn" id="proverb-audio-btn">🔊 发音</button>
                                <button class="proverb-action-btn" id="proverb-fav-btn">⭐ 收藏</button>
                            </div>
                        </div>
                        <button class="proverb-next-btn" id="proverbs-random-btn">
                            <span>换一个</span>
                            <span class="hint-key">Enter</span>
                        </button>
                    </div>
                    
                    <div class="proverbs-list-content" id="proverbs-list-content" style="display: none;">
                        <div class="proverbs-grid-premium" id="proverbs-list"></div>
                        <div class="proverbs-pagination" id="proverbs-pagination"></div>
                    </div>
                    
                    <div class="proverbs-favorites-content" id="proverbs-favorites-content" style="display: none;">
                        <div class="proverbs-grid-premium" id="proverbs-favorites-list"></div>
                    </div>
                </div>

                <div id="page-phrases" class="page">
                    <div class="phrases-header-premium">
                        <div class="phrases-header-left">
                            <h1 class="phrases-title-premium">短语学习</h1>
                            <p class="phrases-subtitle-premium">常用短语，地道表达</p>
                        </div>
                        <div class="phrases-header-stats">
                            <div class="phrase-stat">
                                <span class="phrase-stat-icon">📝</span>
                                <span class="phrase-stat-value" id="phrases-total-count">0</span>
                                <span class="phrase-stat-label">条短语</span>
                            </div>
                            <div class="phrase-stat">
                                <span class="phrase-stat-icon">⭐</span>
                                <span class="phrase-stat-value" id="phrases-fav-count">0</span>
                                <span class="phrase-stat-label">已收藏</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="phrases-toolbar">
                        <div class="phrases-tabs">
                            <button class="phrases-tab active" data-tab="random">随机</button>
                            <button class="phrases-tab" data-tab="all">全部</button>
                            <button class="phrases-tab" data-tab="favorites">收藏</button>
                        </div>
                        <div class="phrases-search">
                            <input type="text" class="phrases-search-input" id="phrases-search-input" placeholder="搜索短语...">
                        </div>
                    </div>
                    
                    <div class="phrases-content" id="phrases-random-content">
                        <div class="phrase-card-premium" id="phrase-random-card">
                            <div class="phrase-content-premium" id="phrase-content">break a leg</div>
                            <div class="phrase-translation-premium" id="phrase-translation">祝你好运</div>
                            <div class="phrase-actions">
                                <button class="phrase-action-btn" id="phrase-audio-btn">🔊 发音</button>
                                <button class="phrase-action-btn" id="phrase-fav-btn">⭐ 收藏</button>
                            </div>
                        </div>
                        <button class="phrase-next-btn" id="phrases-random-btn">
                            <span>换一个</span>
                            <span class="hint-key">Enter</span>
                        </button>
                    </div>
                    
                    <div class="phrases-list-content" id="phrases-list-content" style="display: none;">
                        <div class="phrases-grid-premium" id="phrases-list"></div>
                        <div class="phrases-pagination" id="phrases-pagination"></div>
                    </div>
                    
                    <div class="phrases-favorites-content" id="phrases-favorites-content" style="display: none;">
                        <div class="phrases-grid-premium" id="phrases-favorites-list"></div>
                    </div>
                </div>

                <div id="page-achievements" class="page">
                    <div class="ach-page-header">
                        <h1 class="ach-page-title">🏆 成就中心</h1>
                        <div class="ach-progress-badge">
                            <span class="ach-progress-num" id="ach-unlocked-num">0</span>
                            <span class="ach-progress-divider">/</span>
                            <span class="ach-progress-total" id="ach-total-num">100</span>
                        </div>
                    </div>
                    
                    <div class="ach-stats-row">
                        <div class="ach-stat-item">
                            <span class="ach-stat-icon">✅</span>
                            <span class="ach-stat-value" id="ach-unlocked-count">0</span>
                            <span class="ach-stat-label">已解锁</span>
                        </div>
                        <div class="ach-stat-item">
                            <span class="ach-stat-icon">🔒</span>
                            <span class="ach-stat-value" id="ach-locked-count">100</span>
                            <span class="ach-stat-label">未解锁</span>
                        </div>
                        <div class="ach-stat-item">
                            <span class="ach-stat-icon">💎</span>
                            <span class="ach-stat-value" id="ach-points">0</span>
                            <span class="ach-stat-label">成就点</span>
                        </div>
                    </div>
                    
                    <div class="ach-filter-row">
                        <button class="ach-filter-btn active" data-category="all">🏆 全部</button>
                        <button class="ach-filter-btn" data-category="general">🌟 综合</button>
                        <button class="ach-filter-btn" data-category="recite">📖 背诵</button>
                        <button class="ach-filter-btn" data-category="review">📝 复习</button>
                        <button class="ach-filter-btn" data-category="search">🔍 搜索</button>
                        <button class="ach-filter-btn" data-category="notebook">📓 生词本</button>
                        <button class="ach-filter-btn" data-category="memory">🎴 记忆卡牌</button>
                        <button class="ach-filter-btn" data-category="dungeon">⚔️ 地下城</button>
                        <button class="ach-filter-btn" data-category="typing">⌨️ 打字游戏</button>
                        <button class="ach-filter-btn" data-category="gacha">🎰 抽卡集卡</button>
                        <button class="ach-filter-btn" data-category="audio">🎧 听力口语</button>
                        <button class="ach-filter-btn" data-category="content">📜 谚语短语</button>
                        <button class="ach-filter-btn" data-category="alphabet">🔤 字母达人</button>
                    </div>
                    
                    <div class="ach-grid" id="achievements-grid"></div>
                </div>
                
                <div class="achievement-modal-overlay" id="achievement-modal-overlay"></div>
                <div class="achievement-modal" id="achievement-modal">
                    <div class="achievement-modal-content">
                        <button class="achievement-modal-close" id="achievement-modal-close">✕</button>
                        <div class="achievement-modal-header">
                            <div class="achievement-modal-icon" id="achievement-modal-icon">🏆</div>
                            <div class="achievement-modal-title" id="achievement-modal-title">成就名称</div>
                            <div class="achievement-modal-category" id="achievement-modal-category">综合</div>
                        </div>
                        <div class="achievement-modal-body">
                            <div class="achievement-modal-description" id="achievement-modal-description">成就描述</div>
                            <div class="achievement-modal-timeline">
                                <div class="achievement-modal-status" id="achievement-modal-status">
                                    <span class="status-icon">✅</span>
                                    <span class="status-text">已解锁</span>
                                </div>
                                <div class="achievement-modal-time" id="achievement-modal-time">
                                    <span class="time-icon">📅</span>
                                    <span class="time-text">解锁时间：--</span>
                                </div>
                            </div>
                            <div class="achievement-modal-tip" id="achievement-modal-tip" style="display:none;">
                                <div class="tip-header">💡 解锁提示</div>
                                <div class="tip-content" id="achievement-modal-tip-content">前往相关页面完成任务</div>
                            </div>
                        </div>
                        <div class="achievement-modal-footer">
                            <button class="achievement-modal-action-btn" id="achievement-modal-action-btn">关闭</button>
                        </div>
                    </div>
                </div>

                <div id="page-gacha" class="page">
                    <div class="gacha-header">
                        <div class="gacha-title-section">
                            <h1 class="gacha-main-title">✨ 单词抽卡</h1>
                            <p class="gacha-subtitle">收集单词卡片，解锁成就</p>
                        </div>
                        <div class="gacha-score-display">
                            <div class="score-icon">💰</div>
                            <div class="score-info">
                                <span class="score-label">积分余额</span>
                                <span class="score-value" id="gacha-score">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="gacha-nav">
                        <button class="gacha-nav-btn active" data-section="draw">🎯 抽卡</button>
                        <button class="gacha-nav-btn" data-section="collection">📚 收藏</button>
                    </div>
                    
                    <div id="gacha-draw-section" class="gacha-section active">
                        <div class="gacha-machine-container">
                            <div class="gacha-machine">
                                <div class="machine-top">
                                    <div class="machine-lights">
                                        <span class="light light-1"></span>
                                        <span class="light light-2"></span>
                                        <span class="light light-3"></span>
                                    </div>
                                    <div class="machine-title">WORD GACHA</div>
                                </div>
                                <div class="machine-display">
                                    <div class="display-glow"></div>
                                    <div class="gacha-card-slot" id="gacha-card-slot">
                                        <div class="gacha-placeholder">
                                            <span class="placeholder-icon">?</span>
                                            <span class="placeholder-text">点击抽卡</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="machine-bottom">
                                    <div class="gacha-buttons-row">
                                        <button class="gacha-draw-btn gacha-single-btn" id="gacha-single-btn">
                                            <span class="btn-icon">🎴</span>
                                            <span class="btn-text">单抽</span>
                                            <span class="btn-cost">100 💰</span>
                                        </button>
                                        <button class="gacha-draw-btn gacha-ten-btn" id="gacha-ten-btn">
                                            <span class="btn-icon">🎴🎴🎴</span>
                                            <span class="btn-text">十连抽</span>
                                            <span class="btn-cost">900 💰</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="gacha-result-area" id="gacha-result"></div>
                        
                        <div class="gacha-rarity-info">
                            <div class="rarity-item rarity-legendary">
                                <span class="rarity-star">⭐⭐⭐⭐⭐</span>
                                <span class="rarity-name">传说</span>
                                <span class="rarity-rate">2%</span>
                            </div>
                            <div class="rarity-item rarity-epic">
                                <span class="rarity-star">⭐⭐⭐⭐</span>
                                <span class="rarity-name">史诗</span>
                                <span class="rarity-rate">8%</span>
                            </div>
                            <div class="rarity-item rarity-rare">
                                <span class="rarity-star">⭐⭐⭐</span>
                                <span class="rarity-name">稀有</span>
                                <span class="rarity-rate">20%</span>
                            </div>
                            <div class="rarity-item rarity-common">
                                <span class="rarity-star">⭐⭐</span>
                                <span class="rarity-name">普通</span>
                                <span class="rarity-rate">70%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="gacha-collection-section" class="gacha-section">
                        <div class="collection-header">
                            <div class="collection-stats">
                                <span class="collection-label">已收集</span>
                                <span class="collection-count"><span id="gacha-collected">0</span> / <span id="gacha-total">3500</span></span>
                            </div>
                            <div class="collection-progress-bar">
                                <div class="collection-progress-fill" id="collection-progress-fill"></div>
                            </div>
                        </div>
                        
                        <div class="collection-filters">
                            <div class="filter-row">
                                <span class="filter-label">稀有度:</span>
                                <div class="filter-buttons">
                                    <button class="filter-btn-premium active" data-rarity="all">全部</button>
                                    <button class="filter-btn-premium" data-rarity="legendary">传说</button>
                                    <button class="filter-btn-premium" data-rarity="epic">史诗</button>
                                    <button class="filter-btn-premium" data-rarity="rare">稀有</button>
                                    <button class="filter-btn-premium" data-rarity="common">普通</button>
                                </div>
                            </div>
                            <div class="filter-row">
                                <span class="filter-label">首字母:</span>
                                <div class="alphabet-filter-premium" id="collection-alphabet"></div>
                            </div>
                        </div>
                        
                        <div class="collection-grid-premium" id="collection-grid"></div>
                        <div class="collection-pagination" id="collection-pagination"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="card-modal" id="card-modal">
        <div class="modal-overlay" id="modal-overlay"></div>
        <div class="card-modal-content" id="card-modal-content">
            <button class="modal-close" id="modal-close">✕</button>
            <div class="card-modal-inner" id="card-modal-inner">
                <div class="card-id-badge" id="card-id-badge">WRD-0000</div>
                <div class="card-rarity-badge" id="card-rarity-badge"></div>
                <div class="card-main-info">
                    <div class="card-word-title" id="card-word-title"></div>
                    <div class="card-phonetic-text" id="card-phonetic-text"></div>
                </div>
                <div class="card-meaning-section">
                    <div class="card-section-label">释义</div>
                    <div class="card-meaning-text" id="card-meaning-text"></div>
                </div>
                <div class="card-example-section">
                    <div class="card-section-label">例句</div>
                    <div class="card-example-text" id="card-example-text"></div>
                </div>
                <div class="card-effect-section" id="card-effect-section">
                    <div class="card-section-label">卡牌效果</div>
                    <div class="card-effect-name" id="card-effect-name"></div>
                    <div class="card-effect-desc" id="card-effect-desc"></div>
                </div>
                <div class="card-meta-info">
                    <div class="card-meta-item">
                        <span class="meta-label">稀有度</span>
                        <span class="meta-value" id="card-rarity-text">普通</span>
                    </div>
                    <div class="card-meta-item">
                        <span class="meta-label">获得时间</span>
                        <span class="meta-value" id="card-draw-time">--</span>
                    </div>
                </div>
                <div class="card-modal-actions">
                    <button class="card-action-btn" id="card-audio-btn">🔊 发音</button>
                    <button class="card-action-btn" id="card-notebook-btn">➕ 生词本</button>
                </div>
            </div>
        </div>
    </div>

    <div class="achievement-modal hidden" id="achievement-modal">
        <div class="achievement-modal-overlay" onclick="document.getElementById('achievement-modal').classList.add('hidden')"></div>
        <div class="achievement-modal-content">
            <button class="achievement-modal-close" onclick="document.getElementById('achievement-modal').classList.add('hidden')">✕</button>
            <div class="achievement-modal-icon" id="achievement-modal-icon">🏆</div>
            <div class="achievement-modal-name" id="achievement-modal-name">成就名称</div>
            <div class="achievement-modal-desc" id="achievement-modal-desc">成就描述</div>
            <div class="achievement-modal-time" id="achievement-modal-time">获得时间</div>
        </div>
    </div>

    <div class="achievement-toast hidden" id="achievement-toast">
        <div class="toast-icon">🏆</div>
        <div class="toast-content">
            <div class="toast-title">成就解锁!</div>
            <div class="toast-name" id="achievement-toast-name">成就名称</div>
        </div>
    </div>

    <script src="vocabulary-3500.js"></script>
    <script src="proverbs-data.js"></script>
    <script src="phrases-data.js"></script>
    <script src="data.js"></script>
    <script src="app.js"></script>
    <script src="dungeon-game.js"></script>
    <link rel="stylesheet" href="dungeon-new.css">
    <script>
        console.log('=== SCRIPT LOADED ===');
        
        // 全局变量
        window.inlineReciteMode = 'order';
        window.inlineSelectedLetter = '';
        window.inlineWordList = [];
        window.inlineWordIndex = 0;
        
        // 播放单词音频 - 增强版
        window.playWordAudioInline = function(wordStr) {
            console.log('playWordAudioInline called, word:', wordStr);
            
            if (!('speechSynthesis' in window)) {
                console.log('speechSynthesis not supported');
                return;
            }
            
            var word = wordStr;
            if (!word && window.inlineWordList && window.inlineWordIndex < window.inlineWordList.length) {
                word = window.inlineWordList[window.inlineWordIndex].word;
            }
            
            if (!word) {
                console.log('No word to play');
                return;
            }
            
            console.log('Playing word:', word);
            
            // 取消之前的语音
            speechSynthesis.cancel();
            
            // 创建新的语音
            var utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            utterance.rate = 0.85;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            // 尝试获取英语声音
            var voices = speechSynthesis.getVoices();
            var englishVoice = voices.find(function(v) { 
                return v.lang.indexOf('en') !== -1 && v.lang.indexOf('US') !== -1; 
            }) || voices.find(function(v) { 
                return v.lang.indexOf('en') !== -1; 
            });
            
            if (englishVoice) {
                utterance.voice = englishVoice;
            }
            
            utterance.onstart = function() {
                console.log('Speech started for:', word);
            };
            
            utterance.onend = function() {
                console.log('Speech ended');
            };
            
            utterance.onerror = function(e) {
                console.log('Speech error:', e);
            };
            
            // 延迟播放以确保兼容性
            setTimeout(function() {
                speechSynthesis.speak(utterance);
            }, 50);
        };
        
        // 初始化语音引擎
        window.initSpeechSynthesis = function() {
            if (!('speechSynthesis' in window)) return;
            
            // 加载声音列表
            speechSynthesis.getVoices();
            
            // 某些浏览器需要等待 voiceschanged 事件
            speechSynthesis.onvoiceschanged = function() {
                console.log('Voices loaded:', speechSynthesis.getVoices().length);
            };
        };
        
        // 页面加载时初始化语音
        window.initSpeechSynthesis();
        
        // 开始背诵会话
        window.startReciteSessionInline = function() {
            if (!vocabulary3500 || !vocabulary3500.words) return;
            
            console.log('Starting session with mode:', window.inlineReciteMode);
            
            if (window.inlineReciteMode === 'order') {
                // 顺序模式：从进度位置开始
                var progress = gameState.reciteProgress || 0;
                window.inlineWordList = vocabulary3500.words.slice(progress);
            } else if (window.inlineReciteMode === 'random') {
                // 随机模式：随机打乱所有单词
                window.inlineWordList = vocabulary3500.words.slice().sort(function() { 
                    return Math.random() - 0.5; 
                });
            } else if (window.inlineReciteMode === 'letter' && window.inlineSelectedLetter) {
                // 字母模式：按首字母筛选
                window.inlineWordList = vocabulary3500.words.filter(function(w) {
                    return w.word.charAt(0).toUpperCase() === window.inlineSelectedLetter;
                });
            } else if (window.inlineReciteMode === 'notebook') {
                // 生词模式：从生词本中背诵
                window.inlineWordList = gameState.notebook.map(function(wordStr) {
                    return vocabulary3500.words.find(function(v) { return v.word === wordStr; });
                }).filter(function(w) { return w; });
            } else {
                window.inlineWordList = vocabulary3500.words.slice();
            }
            
            window.inlineWordIndex = 0;
            displayWordInline();
        };
        
        // 显示单词
        window.displayWordInline = function() {
            var container = document.getElementById('recite-card-container');
            if (!container) return;
            
            if (!window.inlineWordList || window.inlineWordList.length === 0 || 
                window.inlineWordIndex >= window.inlineWordList.length) {
                container.innerHTML = '<div class="recite-complete"><h2>🎉 恭喜完成！</h2><p>本组单词已全部背诵完毕</p></div>';
                return;
            }
            
            var word = window.inlineWordList[window.inlineWordIndex];
            var wordIndex = vocabulary3500.words.findIndex(function(w) { return w.word === word.word; }) + 1;
            var isFavorite = gameState.notebook.includes(word.word);
            
            var html = '<div class="recite-card-premium" id="recite-card">' +
                '<div class="card-front-premium">' +
                    '<div class="card-top">' +
                        '<span class="word-badge">#' + String(wordIndex).padStart(4, '0') + '</span>' +
                        '<div class="card-top-actions">' +
                            '<button class="favorite-btn' + (isFavorite ? ' active' : '') + '" id="recite-favorite-btn">' + (isFavorite ? '♥' : '♡') + '</button>' +
                            '<button class="sound-btn" id="recite-audio-btn">🔊</button>' +
                        '</div>' +
                    '</div>' +
                    '<div class="card-main">' +
                        '<div class="word-main">' + word.word + '</div>' +
                        '<div class="word-phonetic-premium">' + word.phonetic + '</div>' +
                    '</div>' +
                    '<button class="reveal-btn" id="recite-show-btn">' +
                        '<span>显示释义</span>' +
                        '<span class="hint-key">Space</span>' +
                    '</button>' +
                '</div>' +
                '<div class="card-back-premium">' +
                    '<div class="card-top">' +
                        '<span class="word-badge">#' + String(wordIndex).padStart(4, '0') + '</span>' +
                        '<div class="card-top-actions">' +
                            '<button class="favorite-btn' + (isFavorite ? ' active' : '') + '" id="recite-favorite-btn-back">' + (isFavorite ? '♥' : '♡') + '</button>' +
                            '<button class="sound-btn" id="recite-audio-btn-back">🔊</button>' +
                        '</div>' +
                    '</div>' +
                    '<div class="card-main-back">' +
                        '<div class="word-back">' + word.word + '</div>' +
                        '<div class="phonetic-back">' + word.phonetic + '</div>' +
                    '</div>' +
                    '<div class="meaning-block">' +
                        '<div class="block-label">释义</div>' +
                        '<div class="block-content">' + word.meaning + '</div>' +
                    '</div>' +
                    '<div class="example-block">' +
                        '<div class="block-label">例句</div>' +
                        '<div class="block-content">' + (word.example || '') + '</div>' +
                    '</div>' +
                    '<button class="hide-btn" id="recite-hide-btn">' +
                        '<span>◀ 收起释义</span>' +
                        '<span class="hint-key">Space</span>' +
                    '</button>' +
                    '<div class="action-buttons">' +
                        '<button class="action-btn-premium btn-unknown" id="recite-unknown-btn">' +
                            '<span class="btn-emoji">❌</span>' +
                            '<span class="btn-label">不认识</span>' +
                            '<span class="btn-key">A</span>' +
                        '</button>' +
                        '<button class="action-btn-premium btn-hard" id="recite-hard-btn">' +
                            '<span class="btn-emoji">🤔</span>' +
                            '<span class="btn-label">有点难</span>' +
                            '<span class="btn-key">S</span>' +
                        '</button>' +
                        '<button class="action-btn-premium btn-known" id="recite-know-btn">' +
                            '<span class="btn-emoji">✅</span>' +
                            '<span class="btn-label">已掌握</span>' +
                            '<span class="btn-key">D</span>' +
                        '</button>' +
                    '</div>' +
                '</div>' +
            '</div>';
            
            container.innerHTML = html;
            updateProgressInline();
        };
        
        // 更新进度
        window.updateProgressInline = function() {
            var currentEl = document.getElementById('recite-current');
            var totalEl = document.getElementById('recite-total');
            var progressFill = document.getElementById('recite-progress-fill');
            var percentageEl = document.getElementById('recite-percentage');
            
            var total = window.inlineWordList.length;
            var current = window.inlineWordIndex + 1;
            var percent = Math.round((current / total) * 100);
            
            if (currentEl) currentEl.textContent = current;
            if (totalEl) totalEl.textContent = total;
            if (progressFill) progressFill.style.width = percent + '%';
            if (percentageEl) percentageEl.textContent = percent + '%';
        };
        
        // 处理答案
        window.handleAnswerInline = function(result) {
            console.log('Handle answer:', result);
            
            if (!window.inlineWordList || window.inlineWordIndex >= window.inlineWordList.length) return;
            
            var word = window.inlineWordList[window.inlineWordIndex];
            
            // 初始化 wordStatus
            if (!gameState.wordStatus) gameState.wordStatus = {};
            
            if (result === 'unknown') {
                // 不认识：加入生词本，标记为学习中
                if (!gameState.notebook.includes(word.word)) {
                    gameState.notebook.push(word.word);
                }
                gameState.wordStatus[word.word] = 'learning';
            } else if (result === 'know') {
                // 已掌握：更新进度，标记为已掌握
                gameState.reciteProgress = (gameState.reciteProgress || 0) + 1;
                gameState.todayLearned = (gameState.todayLearned || 0) + 1;
                gameState.wordStatus[word.word] = 'mastered';
                addScore(5);
                
                // 解锁成就
                if (typeof unlockAchievement === 'function') {
                    if (gameState.reciteProgress === 1) unlockAchievement(2);
                    if (gameState.reciteProgress >= 10) unlockAchievement(3);
                    if (gameState.reciteProgress >= 100) unlockAchievement(4);
                    if (gameState.reciteProgress >= 1000) unlockAchievement(5);
                    if (gameState.reciteProgress >= 3500) unlockAchievement(6);
                }
            } else if (result === 'hard') {
                // 有点难：加入生词本，标记为学习中
                if (!gameState.notebook.includes(word.word)) {
                    gameState.notebook.push(word.word);
                }
                gameState.wordStatus[word.word] = 'learning';
                gameState.todayLearned = (gameState.todayLearned || 0) + 1;
                addScore(2);
            }
            
            // 检查生词本成就
            if (typeof unlockAchievement === 'function') {
                if (gameState.notebook.length >= 10) unlockAchievement(9);
                if (gameState.notebook.length >= 100) unlockAchievement(10);
            }
            
            saveGameState();
            if (typeof updateDailyGoal === 'function') {
                updateDailyGoal();
            }
            window.inlineWordIndex++;
            displayWordInline();
        };
        
        // 切换收藏
        window.toggleFavoriteInline = function() {
            if (!window.inlineWordList || window.inlineWordIndex >= window.inlineWordList.length) return;
            
            var word = window.inlineWordList[window.inlineWordIndex];
            var btn1 = document.getElementById('recite-favorite-btn');
            var btn2 = document.getElementById('recite-favorite-btn-back');
            
            // 初始化 wordStatus
            if (!gameState.wordStatus) gameState.wordStatus = {};
            
            if (gameState.notebook.includes(word.word)) {
                var idx = gameState.notebook.indexOf(word.word);
                gameState.notebook.splice(idx, 1);
                if (btn1) { btn1.textContent = '♡'; btn1.classList.remove('active'); }
                if (btn2) { btn2.textContent = '♡'; btn2.classList.remove('active'); }
            } else {
                gameState.notebook.push(word.word);
                // 如果还没有状态，标记为新词
                if (!gameState.wordStatus[word.word]) {
                    gameState.wordStatus[word.word] = 'new';
                }
                if (btn1) { btn1.textContent = '♥'; btn1.classList.add('active'); }
                if (btn2) { btn2.textContent = '♥'; btn2.classList.add('active'); }
            }
            saveGameState();
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== DOMCONTENTLOADED ===');
            
            // 初始化字母选择器
            var letterGrid = document.getElementById('letter-grid');
            if (letterGrid) {
                var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
                var letterHtml = '';
                letters.forEach(function(letter) {
                    letterHtml += '<button data-letter="' + letter + '">' + letter + '</button>';
                });
                letterGrid.innerHTML = letterHtml;
            }
            
            // 初始化每日目标显示
            if (typeof updateDailyGoal === 'function') {
                updateDailyGoal();
            }
            
            // 导航链接
            var navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(function(link) {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    var page = link.dataset.page;
                    if (typeof navigateTo === 'function') {
                        navigateTo(page);
                    } else {
                        document.querySelectorAll('.page').forEach(function(p) { p.classList.remove('active'); });
                        var targetPage = document.getElementById('page-' + page);
                        if (targetPage) targetPage.classList.add('active');
                        navLinks.forEach(function(l) { l.classList.remove('active'); });
                        link.classList.add('active');
                    }
                });
            });
            
            // 快速开始按钮
            var actionItems = document.querySelectorAll('.action-item-new');
            actionItems.forEach(function(item) {
                item.addEventListener('click', function(e) {
                    var action = item.dataset.action;
                    var pageMap = {
                        'recite': 'word-recite',
                        'review': 'word-review',
                        'memory': 'memory-cards',
                        'dungeon': 'word-dungeon'
                    };
                    if (pageMap[action]) {
                        if (typeof navigateTo === 'function') {
                            navigateTo(pageMap[action]);
                        } else {
                            document.querySelectorAll('.page').forEach(function(p) { p.classList.remove('active'); });
                            var targetPage = document.getElementById('page-' + pageMap[action]);
                            if (targetPage) targetPage.classList.add('active');
                        }
                    }
                });
            });
            
            // 点击事件委托
            document.addEventListener('click', function(e) {
                var recitePage = document.getElementById('page-word-recite');
                if (!recitePage || !recitePage.classList.contains('active')) return;
                
                console.log('Recite page click:', e.target);
                
                var card = document.getElementById('recite-card');
                
                // 显示释义
                if (e.target.closest('#recite-show-btn')) {
                    console.log('Show btn clicked');
                    if (card) card.classList.add('flipped');
                    setTimeout(function() { window.playWordAudioInline(); }, 100);
                }
                
                // 收起释义
                if (e.target.closest('#recite-hide-btn')) {
                    console.log('Hide btn clicked');
                    if (card) card.classList.remove('flipped');
                }
                
                // 不认识
                if (e.target.closest('#recite-unknown-btn')) {
                    console.log('Unknown btn clicked');
                    window.handleAnswerInline('unknown');
                }
                
                // 有点难
                if (e.target.closest('#recite-hard-btn')) {
                    console.log('Hard btn clicked');
                    window.handleAnswerInline('hard');
                }
                
                // 已掌握
                if (e.target.closest('#recite-know-btn')) {
                    console.log('Know btn clicked');
                    window.handleAnswerInline('know');
                }
                
                // 发音
                if (e.target.closest('#recite-audio-btn') || e.target.closest('#recite-audio-btn-back')) {
                    console.log('Audio btn clicked');
                    window.playWordAudioInline();
                }
                
                // 收藏
                if (e.target.closest('#recite-favorite-btn') || e.target.closest('#recite-favorite-btn-back')) {
                    console.log('Favorite btn clicked');
                    window.toggleFavoriteInline();
                }
                
                // 设置按钮
                if (e.target.closest('#recite-settings-btn') || e.target.closest('#goal-setting-btn')) {
                    var modal = document.getElementById('recite-settings-modal');
                    if (modal) modal.classList.add('open');
                }
                
                // 关闭设置
                if (e.target.closest('#close-settings-modal')) {
                    var modal = document.getElementById('recite-settings-modal');
                    if (modal) modal.classList.remove('open');
                }
                
                // 保存设置
                if (e.target.closest('#save-settings-btn')) {
                    var dailyGoalInput = document.getElementById('setting-daily-goal');
                    var autoSpeakInput = document.getElementById('setting-auto-speak');
                    var showExampleInput = document.getElementById('setting-show-example');
                    var showPhoneticInput = document.getElementById('setting-show-phonetic');
                    var activeMode = document.querySelector('.setting-option.active');
                    
                    var settings = {
                        dailyGoal: dailyGoalInput ? parseInt(dailyGoalInput.value) : 50,
                        mode: activeMode ? activeMode.dataset.mode : 'en-zh',
                        autoSpeak: autoSpeakInput ? autoSpeakInput.checked : false,
                        showExample: showExampleInput ? showExampleInput.checked : true,
                        showPhonetic: showPhoneticInput ? showPhoneticInput.checked : true
                    };
                    
                    localStorage.setItem('reciteSettings', JSON.stringify(settings));
                    var modal = document.getElementById('recite-settings-modal');
                    if (modal) modal.classList.remove('open');
                    
                    // 更新每日目标显示
                    var dailyGoalEl = document.getElementById('daily-goal');
                    if (dailyGoalEl) dailyGoalEl.textContent = settings.dailyGoal;
                    
                    // 更新进度条
                    if (typeof updateDailyGoal === 'function') {
                        updateDailyGoal();
                    }
                }
                
                // 自动发音按钮
                if (e.target.closest('#auto-speak-btn')) {
                    var btn = e.target.closest('#auto-speak-btn');
                    btn.classList.toggle('active');
                    var settings = JSON.parse(localStorage.getItem('reciteSettings') || '{}');
                    settings.autoSpeak = btn.classList.contains('active');
                    localStorage.setItem('reciteSettings', JSON.stringify(settings));
                }
                
                // 重置按钮
                if (e.target.closest('#recite-reset')) {
                    if (confirm('确定要重置背诵进度吗？')) {
                        gameState.reciteProgress = 0;
                        gameState.learnedWords = [];
                        saveGameState();
                        window.inlineWordIndex = 0;
                        window.startReciteSessionInline();
                    }
                }
                
                // 模式切换
                if (e.target.closest('.mode-tab')) {
                    var btn = e.target.closest('.mode-tab');
                    var mode = btn.dataset.mode;
                    document.querySelectorAll('.mode-tab').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    
                    window.inlineReciteMode = mode;
                    
                    var letterPicker = document.getElementById('letter-picker');
                    if (letterPicker) {
                        letterPicker.style.display = mode === 'letter' ? 'block' : 'none';
                    }
                    
                    if (mode === 'notebook' && gameState.notebook.length === 0) {
                        alert('生词本是空的，请先添加生词！');
                        return;
                    }
                    
                    window.startReciteSessionInline();
                }
                
                // 字母选择
                if (e.target.closest('#letter-grid button')) {
                    var btn = e.target.closest('#letter-grid button');
                    var letter = btn.dataset.letter;
                    document.querySelectorAll('#letter-grid button').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    window.inlineSelectedLetter = letter;
                    window.startReciteSessionInline();
                }
                
                // 设置选项
                if (e.target.closest('.setting-option')) {
                    var btn = e.target.closest('.setting-option');
                    var parent = btn.parentElement;
                    parent.querySelectorAll('.setting-option').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                }
            });
            
            // 键盘事件
            document.addEventListener('keydown', function(e) {
                var recitePage = document.getElementById('page-word-recite');
                if (!recitePage || !recitePage.classList.contains('active')) return;
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                var card = document.getElementById('recite-card');
                
                if (e.key === ' ' || e.key === 'Enter') {
                    e.preventDefault();
                    if (card && card.classList.contains('flipped')) {
                        card.classList.remove('flipped');
                    } else {
                        if (card) card.classList.add('flipped');
                        setTimeout(window.playWordAudioInline, 100);
                    }
                } else if (e.key.toLowerCase() === 'a' || e.key === '1') {
                    e.preventDefault();
                    if (card && card.classList.contains('flipped')) {
                        window.handleAnswerInline('unknown');
                    }
                } else if (e.key.toLowerCase() === 's' || e.key === '2') {
                    e.preventDefault();
                    if (card && card.classList.contains('flipped')) {
                        window.handleAnswerInline('hard');
                    }
                } else if (e.key.toLowerCase() === 'd' || e.key === '3') {
                    e.preventDefault();
                    if (card && card.classList.contains('flipped')) {
                        window.handleAnswerInline('know');
                    }
                } else if (e.key.toLowerCase() === 'f') {
                    e.preventDefault();
                    window.toggleFavoriteInline();
                }
            });
            
            // 生词本功能
            window.notebookFilter = 'all';
            window.notebookSearch = '';
            window.selectedNotebookWords = new Set();
            
            // 显示生词本
            window.displayNotebookInline = function() {
                var container = document.getElementById('notebook-list');
                var emptyEl = document.getElementById('notebook-empty');
                var countEl = document.getElementById('notebook-count');
                
                if (!container) return;
                
                // 更新统计
                window.updateNotebookStatsInline();
                
                // 筛选单词
                var filteredWords = [];
                gameState.notebook.forEach(function(wordStr) {
                    var word = vocabulary3500.words.find(function(w) { return w.word === wordStr; });
                    if (!word) return;
                    
                    // 搜索过滤
                    if (window.notebookSearch) {
                        var searchMatch = word.word.toLowerCase().includes(window.notebookSearch.toLowerCase()) || 
                                         word.meaning.toLowerCase().includes(window.notebookSearch.toLowerCase());
                        if (!searchMatch) return;
                    }
                    
                    // 状态过滤
                    var status = window.getWordStatusInline(word.word);
                    if (window.notebookFilter !== 'all' && window.notebookFilter !== status) return;
                    
                    filteredWords.push({ word: word, status: status });
                });
                
                if (countEl) countEl.textContent = gameState.notebook.length;
                
                if (filteredWords.length === 0) {
                    container.innerHTML = '';
                    if (emptyEl) emptyEl.style.display = 'flex';
                    return;
                }
                
                if (emptyEl) emptyEl.style.display = 'none';
                
                var html = '';
                filteredWords.forEach(function(item) {
                    var word = item.word;
                    var status = item.status;
                    var isSelected = window.selectedNotebookWords.has(word.word);
                    
                    html += '<div class="notebook-item ' + (isSelected ? 'selected' : '') + '" data-word="' + word.word + '">';
                    html += '<div class="checkbox"></div>';
                    html += '<div class="word-info">';
                    html += '<div class="word-text">' + word.word + '</div>';
                    html += '<div class="word-phonetic">' + word.phonetic + '</div>';
                    html += '</div>';
                    html += '<div class="word-meaning">' + word.meaning + '</div>';
                    html += '<span class="word-status ' + status + '">' + window.getStatusTextInline(status) + '</span>';
                    html += '<div class="word-actions">';
                    html += '<button class="word-action-btn" data-action="speak" data-word="' + word.word + '">🔊 发音</button>';
                    html += '<button class="word-action-btn" data-action="delete" data-word="' + word.word + '">🗑️ 删除</button>';
                    html += '<button class="word-action-btn" data-action="mastered" data-word="' + word.word + '">✅ 已掌握</button>';
                    html += '</div>';
                    html += '</div>';
                });
                container.innerHTML = html;
                
                window.updateBatchActionsInline();
            };
            
            // 获取单词状态
            window.getWordStatusInline = function(word) {
                if (!gameState.wordStatus) gameState.wordStatus = {};
                return gameState.wordStatus[word] || 'new';
            };
            
            // 获取状态文本
            window.getStatusTextInline = function(status) {
                var texts = { 'new': '新词', 'learning': '学习中', 'mastered': '已掌握' };
                return texts[status] || '新词';
            };
            
            // 更新生词本统计
            window.updateNotebookStatsInline = function() {
                var newCount = 0, learningCount = 0, masteredCount = 0;
                
                gameState.notebook.forEach(function(word) {
                    var status = window.getWordStatusInline(word);
                    if (status === 'new') newCount++;
                    else if (status === 'learning') learningCount++;
                    else if (status === 'mastered') masteredCount++;
                });
                
                var newCountEl = document.getElementById('notebook-new-count');
                var learningCountEl = document.getElementById('notebook-learning-count');
                var masteredCountEl = document.getElementById('notebook-mastered-count');
                var masteryRateEl = document.getElementById('notebook-mastery-rate');
                
                if (newCountEl) newCountEl.textContent = newCount;
                if (learningCountEl) learningCountEl.textContent = learningCount;
                if (masteredCountEl) masteredCountEl.textContent = masteredCount;
                
                var total = gameState.notebook.length;
                var rate = total > 0 ? Math.round((masteredCount / total) * 100) : 0;
                if (masteryRateEl) masteryRateEl.textContent = rate + '%';
            };
            
            // 更新批量操作栏
            window.updateBatchActionsInline = function() {
                var batchActions = document.getElementById('notebook-batch-actions');
                var selectedCountEl = document.getElementById('selected-count');
                
                if (batchActions) {
                    batchActions.style.display = window.selectedNotebookWords.size > 0 ? 'flex' : 'none';
                }
                if (selectedCountEl) {
                    selectedCountEl.textContent = window.selectedNotebookWords.size;
                }
            };
            
            // 生词本页面点击事件
            document.addEventListener('click', function(e) {
                var notebookPage = document.getElementById('page-word-notebook');
                if (!notebookPage || !notebookPage.classList.contains('active')) return;
                
                // 筛选按钮
                if (e.target.closest('.notebook-filters .filter-btn')) {
                    var btn = e.target.closest('.filter-btn');
                    document.querySelectorAll('.notebook-filters .filter-btn').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    window.notebookFilter = btn.dataset.filter;
                    window.displayNotebookInline();
                }
                
                // 单词项点击（选择）
                if (e.target.closest('.notebook-item') && !e.target.closest('.word-action-btn')) {
                    var item = e.target.closest('.notebook-item');
                    var word = item.dataset.word;
                    if (window.selectedNotebookWords.has(word)) {
                        window.selectedNotebookWords.delete(word);
                    } else {
                        window.selectedNotebookWords.add(word);
                    }
                    window.displayNotebookInline();
                }
                
                // 单词操作按钮
                if (e.target.closest('.word-action-btn')) {
                    var btn = e.target.closest('.word-action-btn');
                    var action = btn.dataset.action;
                    var word = btn.dataset.word;
                    
                    if (action === 'speak') {
                        if (!('speechSynthesis' in window)) return;
                        speechSynthesis.cancel();
                        var utterance = new SpeechSynthesisUtterance(word);
                        utterance.lang = 'en-US';
                        utterance.rate = 0.9;
                        speechSynthesis.speak(utterance);
                    } else if (action === 'delete') {
                        var index = gameState.notebook.indexOf(word);
                        if (index > -1) {
                            gameState.notebook.splice(index, 1);
                            saveGameState();
                            window.displayNotebookInline();
                        }
                    } else if (action === 'mastered') {
                        if (!gameState.wordStatus) gameState.wordStatus = {};
                        gameState.wordStatus[word] = 'mastered';
                        saveGameState();
                        window.displayNotebookInline();
                    }
                }
                
                // 全选按钮
                if (e.target.closest('#select-all-btn')) {
                    var allSelected = window.selectedNotebookWords.size === gameState.notebook.length;
                    if (allSelected) {
                        window.selectedNotebookWords.clear();
                    } else {
                        gameState.notebook.forEach(function(word) {
                            window.selectedNotebookWords.add(word);
                        });
                    }
                    window.displayNotebookInline();
                }
                
                // 批量删除
                if (e.target.closest('#batch-delete')) {
                    if (window.selectedNotebookWords.size === 0) return;
                    if (!confirm('确定要删除选中的 ' + window.selectedNotebookWords.size + ' 个单词吗？')) return;
                    
                    window.selectedNotebookWords.forEach(function(word) {
                        var index = gameState.notebook.indexOf(word);
                        if (index > -1) gameState.notebook.splice(index, 1);
                    });
                    saveGameState();
                    window.selectedNotebookWords.clear();
                    window.displayNotebookInline();
                }
                
                // 批量标记已掌握
                if (e.target.closest('#batch-mastered')) {
                    if (window.selectedNotebookWords.size === 0) return;
                    if (!gameState.wordStatus) gameState.wordStatus = {};
                    window.selectedNotebookWords.forEach(function(word) {
                        gameState.wordStatus[word] = 'mastered';
                    });
                    saveGameState();
                    window.selectedNotebookWords.clear();
                    window.displayNotebookInline();
                }
                
                // 批量导出
                if (e.target.closest('#batch-export')) {
                    if (window.selectedNotebookWords.size === 0) return;
                    var words = Array.from(window.selectedNotebookWords);
                    var content = words.join('\n');
                    var blob = new Blob([content], { type: 'text/plain' });
                    var url = URL.createObjectURL(blob);
                    var a = document.createElement('a');
                    a.href = url;
                    a.download = 'selected_words.txt';
                    a.click();
                }
                
                // 取消选择
                if (e.target.closest('#batch-cancel')) {
                    window.selectedNotebookWords.clear();
                    window.displayNotebookInline();
                }
                
                // 导出全部
                if (e.target.closest('#export-notebook')) {
                    var content = gameState.notebook.join('\n');
                    var blob = new Blob([content], { type: 'text/plain' });
                    var url = URL.createObjectURL(blob);
                    var a = document.createElement('a');
                    a.href = url;
                    a.download = 'notebook.txt';
                    a.click();
                }
                
                // 导入
                if (e.target.closest('#import-notebook')) {
                    var input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.txt,.json';
                    input.onchange = function(ev) {
                        var file = ev.target.files[0];
                        if (file) {
                            var reader = new FileReader();
                            reader.onload = function(event) {
                                try {
                                    var content = event.target.result;
                                    var words;
                                    if (file.name.endsWith('.json')) {
                                        words = JSON.parse(content);
                                    } else {
                                        words = content.split('\n').map(function(w) { return w.trim(); }).filter(function(w) { return w; });
                                    }
                                    var count = 0;
                                    words.forEach(function(word) {
                                        if (!gameState.notebook.includes(word)) {
                                            gameState.notebook.push(word);
                                            count++;
                                        }
                                    });
                                    saveGameState();
                                    window.displayNotebookInline();
                                    alert('成功导入 ' + count + ' 个新单词');
                                } catch (err) {
                                    alert('导入失败，请检查文件格式');
                                }
                            };
                            reader.readAsText(file);
                        }
                    };
                    input.click();
                }
            });
            
            // 生词本搜索
            document.addEventListener('input', function(e) {
                if (e.target.id === 'notebook-search') {
                    window.notebookSearch = e.target.value;
                    window.displayNotebookInline();
                }
            });
            
            // 复习系统功能
            window.reviewMode = 'choice';
            window.reviewSource = 'all';
            window.reviewIndex = 0;
            window.reviewWords = [];
            window.reviewCorrect = 0;
            window.reviewWrong = 0;
            window.reviewStreak = 0;
            window.wrongWords = [];
            
            // 显示复习页面
            window.displayReviewInline = function() {
                var card = document.getElementById('review-card');
                var optionsContainer = document.getElementById('review-options');
                var spellArea = document.getElementById('review-spell-area');
                var resultArea = document.getElementById('review-result');
                
                if (!card) return;
                
                // 获取复习单词列表
                if (window.reviewSource === 'all') {
                    window.reviewWords = vocabulary3500.words.slice();
                } else if (window.reviewSource === 'notebook') {
                    window.reviewWords = gameState.notebook.map(function(wordStr) {
                        return vocabulary3500.words.find(function(w) { return w.word === wordStr; });
                    }).filter(function(w) { return w; });
                } else if (window.reviewSource === 'wrong') {
                    window.reviewWords = window.wrongWords.map(function(wordStr) {
                        return vocabulary3500.words.find(function(w) { return w.word === wordStr; });
                    }).filter(function(w) { return w; });
                }
                
                if (window.reviewWords.length === 0) {
                    card.innerHTML = '<div class="review-empty"><h3>📚 没有单词</h3><p>请选择其他来源</p></div>';
                    if (optionsContainer) optionsContainer.innerHTML = '';
                    if (spellArea) spellArea.style.display = 'none';
                    if (resultArea) resultArea.innerHTML = '';
                    window.updateReviewStatsInline();
                    return;
                }
                
                // 显示当前单词
                var word = window.reviewWords[window.reviewIndex];
                if (!word) {
                    window.reviewIndex = 0;
                    word = window.reviewWords[0];
                }
                
                var wordIndex = vocabulary3500.words.findIndex(function(w) { return w.word === word.word; }) + 1;
                
                if (window.reviewMode === 'choice') {
                    // 选择题模式
                    var options = window.generateChoiceOptions(word);
                    var html = '<div class="review-word-premium">' + word.word + '</div>';
                    html += '<div class="review-phonetic-premium">' + word.phonetic + '</div>';
                    html += '<div class="review-options-premium">';
                    options.forEach(function(opt, idx) {
                        html += '<button class="review-option-btn" data-index="' + idx + '">' + opt + '</button>';
                    });
                    html += '</div>';
                    card.innerHTML = html;
                    if (optionsContainer) optionsContainer.style.display = 'block';
                    if (spellArea) spellArea.style.display = 'none';
                    if (resultArea) resultArea.innerHTML = '';
                } else if (window.reviewMode === 'spell') {
                    // 拼写模式 - 显示释义，让用户拼写单词
                    var html = '<div class="review-word-premium" style="font-size: 1.25rem;">' + word.meaning + '</div>';
                    html += '<div class="review-phonetic-premium">请拼写单词</div>';
                    html += '<div class="review-spell-area" style="display: flex;">';
                    html += '<input type="text" class="spell-input" id="spell-input" placeholder="输入单词拼写...">';
                    html += '<button class="spell-submit" id="spell-submit">确认</button>';
                    html += '</div>';
                    html += '<div class="review-result-premium" id="review-result"></div>';
                    card.innerHTML = html;
                    if (optionsContainer) optionsContainer.style.display = 'none';
                    
                    // 聚焦输入框
                    setTimeout(function() {
                        var input = document.getElementById('spell-input');
                        if (input) input.focus();
                    }, 100);
                } else if (window.reviewMode === 'listen') {
                    // 听写模式 - 自动播放发音
                    var html = '<div class="review-word-premium">🔊 听写单词</div>';
                    html += '<div class="review-phonetic-premium">点击播放发音或等待自动播放</div>';
                    html += '<button class="listen-play-btn" id="listen-play-btn">🔊 播放发音</button>';
                    html += '<div class="review-spell-area" style="display: flex;">';
                    html += '<input type="text" class="spell-input" id="spell-input" placeholder="输入听到的单词...">';
                    html += '<button class="spell-submit" id="spell-submit">确认</button>';
                    html += '</div>';
                    html += '<div class="review-result-premium" id="review-result"></div>';
                    card.innerHTML = html;
                    if (optionsContainer) optionsContainer.style.display = 'none';
                    
                    // 聚焦输入框
                    setTimeout(function() {
                        var input = document.getElementById('spell-input');
                        if (input) input.focus();
                    }, 100);
                    
                    // 自动播放发音
                    setTimeout(function() {
                        window.playWordAudioInline(word.word);
                    }, 300);
                }
                
                window.updateReviewProgressInline();
            };
            
            // 生成选择题选项
            window.generateChoiceOptions = function(word) {
                var options = [word.meaning];
                var otherWords = vocabulary3500.words.filter(function(w) { return w.word !== word.word; });
                otherWords.sort(function() { return Math.random() - 0.5; });
                var count = 0;
                while (options.length < 4 && count < otherWords.length) {
                    var opt = otherWords[count].meaning;
                    if (!options.includes(opt)) {
                        options.push(opt);
                    }
                    count++;
                }
                options.sort(function() { return Math.random() - 0.5; });
                return options;
            };
            
            // 更新复习进度
            window.updateReviewProgressInline = function() {
                var currentEl = document.getElementById('review-current');
                var totalEl = document.getElementById('review-total');
                var progressBar = document.getElementById('review-progress-bar');
                
                var total = window.reviewWords.length;
                var current = window.reviewIndex + 1;
                
                if (currentEl) currentEl.textContent = current;
                if (totalEl) totalEl.textContent = total;
                if (progressBar) {
                    var percent = (current / total) * 100;
                    progressBar.style.width = percent + '%';
                }
                
                window.updateReviewStatsInline();
            };
            
            // 更新复习统计
            window.updateReviewStatsInline = function() {
                var correctEl = document.getElementById('review-correct');
                var wrongEl = document.getElementById('review-wrong');
                var streakEl = document.getElementById('review-streak');
                
                if (correctEl) correctEl.textContent = window.reviewCorrect;
                if (wrongEl) wrongEl.textContent = window.reviewWrong;
                if (streakEl) streakEl.textContent = window.reviewStreak;
            };
            
            // 处理选择题答案
            window.handleChoiceAnswer = function(index) {
                var word = window.reviewWords[window.reviewIndex];
                var options = window.generateChoiceOptions(word);
                var isCorrect = options[index] === word.meaning;
                
                var resultArea = document.getElementById('review-result');
                var nextBtn = document.getElementById('review-next-btn');
                var optionBtns = document.querySelectorAll('.review-option-btn');
                
                optionBtns.forEach(function(btn, idx) {
                    btn.classList.remove('correct', 'wrong');
                    if (idx === index) {
                        if (isCorrect) {
                            btn.classList.add('correct');
                            window.reviewCorrect++;
                            window.reviewStreak++;
                            if (resultArea) resultArea.innerHTML = '<span class="result-correct">✅ 正确！</span>';
                            
                            // 解锁复习成就
                            if (typeof unlockAchievement === 'function') {
                                unlockAchievement(11);
                                if (window.reviewStreak >= 20) unlockAchievement(72);
                            }
                        } else {
                            btn.classList.add('wrong');
                            window.reviewWrong++;
                            window.reviewStreak = 0;
                            if (!window.wrongWords.includes(word.word)) {
                                window.wrongWords.push(word.word);
                            }
                            if (resultArea) resultArea.innerHTML = '<span class="result-wrong">❌ 错误！正确答案：' + word.meaning + '</span>';
                        }
                    } else {
                        btn.disabled = true;
                    }
                });
                
                saveGameState();
                window.updateReviewStatsInline();
                
                // 自动跳转到下一个
                setTimeout(function() {
                    window.nextReviewWord();
                }, 1000);
            };
            
            // 处理拼写答案
            window.handleSpellAnswer = function() {
                console.log('handleSpellAnswer called');
                
                var word = window.reviewWords[window.reviewIndex];
                var input = document.getElementById('spell-input');
                
                console.log('word:', word);
                console.log('input:', input);
                
                if (!input || !word) {
                    console.log('Missing input or word');
                    return;
                }
                
                var userAnswer = input.value.trim().toLowerCase();
                var correctAnswer = word.word.toLowerCase();
                
                console.log('userAnswer:', userAnswer, 'correctAnswer:', correctAnswer);
                
                var resultArea = document.getElementById('review-result');
                
                if (userAnswer === correctAnswer) {
                    window.reviewCorrect++;
                    window.reviewStreak++;
                    if (resultArea) resultArea.innerHTML = '<span class="result-correct">✅ 正确！' + word.word + '</span>';
                } else {
                    window.reviewWrong++;
                    window.reviewStreak = 0;
                    if (!window.wrongWords.includes(word.word)) {
                        window.wrongWords.push(word.word);
                    }
                    if (resultArea) resultArea.innerHTML = '<span class="result-wrong">❌ 错误！正确答案：' + word.word + '</span>';
                }
                
                // 禁用输入框
                input.disabled = true;
                var submitBtn = document.getElementById('spell-submit');
                if (submitBtn) submitBtn.disabled = true;
                
                saveGameState();
                window.updateReviewStatsInline();
                
                // 自动跳转到下一个
                setTimeout(function() {
                    window.nextReviewWord();
                }, 1500);
            };
            
            // 播放听写发音
            window.playListenAudio = function() {
                var word = window.reviewWords[window.reviewIndex];
                if (!word) return;
                
                if (!('speechSynthesis' in window)) return;
                speechSynthesis.cancel();
                var utterance = new SpeechSynthesisUtterance(word.word);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                speechSynthesis.speak(utterance);
            };
            
            // 下一个复习单词
            window.nextReviewWord = function() {
                window.reviewIndex++;
                if (window.reviewIndex >= window.reviewWords.length) {
                    window.reviewIndex = 0;
                }
                window.displayReviewInline();
            };
            
            // 复习页面点击事件
            document.addEventListener('click', function(e) {
                var reviewPage = document.getElementById('page-word-review');
                if (!reviewPage || !reviewPage.classList.contains('active')) return;
                
                console.log('Review page click:', e.target);
                
                // 模式切换
                if (e.target.closest('.review-mode-tabs .review-mode-tab')) {
                    var btn = e.target.closest('.review-mode-tab');
                    document.querySelectorAll('.review-mode-tabs .review-mode-tab').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    window.reviewMode = btn.dataset.mode;
                    window.displayReviewInline();
                }
                
                // 来源切换
                if (e.target.closest('.review-source-tabs .source-tab')) {
                    var btn = e.target.closest('.source-tab');
                    document.querySelectorAll('.review-source-tabs .source-tab').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    window.reviewSource = btn.dataset.source;
                    window.reviewIndex = 0;
                    window.displayReviewInline();
                }
                
                // 选择题选项
                if (e.target.closest('.review-option-btn')) {
                    var btn = e.target.closest('.review-option-btn');
                    if (!btn.disabled) {
                        var index = parseInt(btn.dataset.index);
                        console.log('Choice option clicked:', index);
                        window.handleChoiceAnswer(index);
                    }
                }
                
                // 拼写确认
                if (e.target.closest('#spell-submit')) {
                    console.log('Spell submit clicked');
                    window.handleSpellAnswer();
                }
                
                // 听写发音按钮
                if (e.target.closest('#listen-play-btn')) {
                    console.log('Listen play btn clicked');
                    var word = window.reviewWords[window.reviewIndex];
                    if (word) {
                        window.playWordAudioInline(word.word);
                    }
                }
            });
            
            // 复习键盘事件
            document.addEventListener('keydown', function(e) {
                var reviewPage = document.getElementById('page-word-review');
                if (!reviewPage || !reviewPage.classList.contains('active')) return;
                
                // 输入框内的键盘事件
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        var input = document.getElementById('spell-input');
                        if (input && !input.disabled) {
                            window.handleSpellAnswer();
                        }
                    }
                    return;
                }
                
                // 选择题键盘快捷键
                if (window.reviewMode === 'choice') {
                    if (e.key === '1' || e.key === '2' || e.key === '3' || e.key === '4') {
                        e.preventDefault();
                        var index = parseInt(e.key) - 1;
                        window.handleChoiceAnswer(index);
                    }
                }
            });
            
            // 单词搜索功能
            window.searchQuery = '';
            window.searchLetter = '';
            window.searchPage = 1;
            window.searchPageSize = 20;
            
            // 初始化字母筛选器
            var alphabetFilter = document.getElementById('alphabet-filter');
            if (alphabetFilter) {
                var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
                var letterHtml = '<button class="alphabet-btn active" data-letter="">全部</button>';
                letters.forEach(function(letter) {
                    letterHtml += '<button class="alphabet-btn" data-letter="' + letter + '">' + letter + '</button>';
                });
                alphabetFilter.innerHTML = letterHtml;
            }
            
            // 显示搜索结果
            window.displaySearchResults = function() {
                var resultsContainer = document.getElementById('search-results');
                var countEl = document.getElementById('search-results-count');
                
                if (!resultsContainer) return;
                
                var results = vocabulary3500.words.filter(function(word) {
                    // 搜索过滤
                    if (window.searchQuery) {
                        var query = window.searchQuery.toLowerCase();
                        if (!word.word.toLowerCase().includes(query) && 
                            !word.meaning.toLowerCase().includes(query)) {
                            return false;
                        }
                    }
                    
                    // 字母过滤
                    if (window.searchLetter) {
                        if (word.word.charAt(0).toUpperCase() !== window.searchLetter) {
                            return false;
                        }
                    }
                    
                    return true;
                });
                
                // 排序
                var sortSelect = document.getElementById('search-sort');
                if (sortSelect && sortSelect.value === 'asc') {
                    results.sort(function(a, b) { return a.word.localeCompare(b.word); });
                } else if (sortSelect && sortSelect.value === 'desc') {
                    results.sort(function(a, b) { return b.word.localeCompare(a.word); });
                }
                
                if (countEl) countEl.textContent = results.length;
                
                // 分页
                var start = (window.searchPage - 1) * window.searchPageSize;
                var end = start + window.searchPageSize;
                var pageResults = results.slice(start, end);
                
                if (pageResults.length === 0) {
                    resultsContainer.innerHTML = '<div class="search-empty"><p>没有找到匹配的单词</p></div>';
                    return;
                }
                
                var html = '';
                pageResults.forEach(function(word) {
                    var wordIndex = vocabulary3500.words.findIndex(function(w) { return w.word === word.word; }) + 1;
                    var isFavorite = gameState.notebook.includes(word.word);
                    
                    html += '<div class="search-result-item" data-word="' + word.word + '">';
                    html += '<div class="result-header">';
                    html += '<span class="result-number">#' + String(wordIndex).padStart(4, '0') + '</span>';
                    html += '<div class="result-actions">';
                    html += '<button class="result-action-btn" data-action="speak" data-word="' + word.word + '">🔊</button>';
                    html += '<button class="result-action-btn favorite' + (isFavorite ? ' active' : '') + '" data-action="favorite" data-word="' + word.word + '">' + (isFavorite ? '♥' : '♡') + '</button>';
                    html += '</div>';
                    html += '</div>';
                    html += '<div class="result-word">' + word.word + '</div>';
                    html += '<div class="result-phonetic">' + word.phonetic + '</div>';
                    html += '<div class="result-meaning">' + word.meaning + '</div>';
                    html += '</div>';
                });
                resultsContainer.innerHTML = html;
                
                // 分页控件
                var paginationContainer = document.getElementById('search-pagination');
                if (paginationContainer) {
                    var totalPages = Math.ceil(results.length / window.searchPageSize);
                    if (totalPages <= 1) {
                        paginationContainer.innerHTML = '';
                    } else {
                        var paginationHtml = '';
                        if (window.searchPage > 1) {
                            paginationHtml += '<button class="pagination-btn" data-page="' + (window.searchPage - 1) + '">上一页</button>';
                        }
                        paginationHtml += '<span class="pagination-info">第 ' + window.searchPage + ' / ' + totalPages + ' 页</span>';
                        if (window.searchPage < totalPages) {
                            paginationHtml += '<button class="pagination-btn" data-page="' + (window.searchPage + 1) + '">下一页</button>';
                        }
                        paginationContainer.innerHTML = paginationHtml;
                    }
                }
            };
            
            // 搜索页面点击事件
            document.addEventListener('click', function(e) {
                var searchPage = document.getElementById('page-word-search');
                if (!searchPage || !searchPage.classList.contains('active')) return;
                
                // 字母筛选
                if (e.target.closest('.alphabet-btn')) {
                    var btn = e.target.closest('.alphabet-btn');
                    document.querySelectorAll('.alphabet-btn').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    window.searchLetter = btn.dataset.letter || '';
                    window.searchPage = 1;
                    window.displaySearchResults();
                }
                
                // 搜索结果操作
                if (e.target.closest('.result-action-btn')) {
                    var btn = e.target.closest('.result-action-btn');
                    var action = btn.dataset.action;
                    var word = btn.dataset.word;
                    
                    if (action === 'speak') {
                        window.playWordAudioInline(word);
                    } else if (action === 'favorite') {
                        if (gameState.notebook.includes(word)) {
                            var idx = gameState.notebook.indexOf(word);
                            gameState.notebook.splice(idx, 1);
                            btn.textContent = '♡';
                            btn.classList.remove('active');
                        } else {
                            gameState.notebook.push(word);
                            btn.textContent = '♥';
                            btn.classList.add('active');
                        }
                        saveGameState();
                    }
                }
                
                // 分页
                if (e.target.closest('.pagination-btn')) {
                    var btn = e.target.closest('.pagination-btn');
                    window.searchPage = parseInt(btn.dataset.page);
                    window.displaySearchResults();
                }
            });
            
            // 搜索输入
            document.addEventListener('input', function(e) {
                if (e.target.id === 'search-input') {
                    window.searchQuery = e.target.value;
                    window.searchPage = 1;
                    window.displaySearchResults();
                    
                    // 罗小黑彩蛋
                    if (window.searchQuery.toLowerCase().includes('罗小黑')) {
                        var modal = document.getElementById('luoxiaohei-modal');
                        if (modal) modal.classList.add('show');
                        if (typeof unlockAchievement === 'function') {
                            unlockAchievement(292);
                        }
                    }
                }
            });
            
            // 搜索按钮
            document.addEventListener('click', function(e) {
                if (e.target.closest('#search-btn')) {
                    var input = document.getElementById('search-input');
                    if (input) {
                        window.searchQuery = input.value;
                        window.searchPage = 1;
                        window.displaySearchResults();
                        
                        // 罗小黑彩蛋
                        if (window.searchQuery.toLowerCase().includes('罗小黑')) {
                            var modal = document.getElementById('luoxiaohei-modal');
                            if (modal) modal.classList.add('show');
                            if (typeof unlockAchievement === 'function') {
                                unlockAchievement(292);
                            }
                        }
                    }
                }
                
                // 清除搜索
                if (e.target.closest('#search-clear-btn')) {
                    var input = document.getElementById('search-input');
                    if (input) input.value = '';
                    window.searchQuery = '';
                    window.searchPage = 1;
                    window.displaySearchResults();
                }
                
                // 关闭罗小黑彩蛋
                if (e.target.closest('#close-luoxiaohei')) {
                    var modal = document.getElementById('luoxiaohei-modal');
                    if (modal) modal.classList.remove('show');
                }
                
                // 点击遮罩关闭彩蛋
                if (e.target.closest('#luoxiaohei-modal') && !e.target.closest('.easter-egg-content')) {
                    var modal = document.getElementById('luoxiaohei-modal');
                    if (modal) modal.classList.remove('show');
                }
            });
            
            // 搜索排序
            document.addEventListener('change', function(e) {
                if (e.target.id === 'search-sort') {
                    window.displaySearchResults();
                }
            });
            
            // 音频播放器功能
            window.audioPlayers = {
                listening: {
                    audio: null,
                    playlist: [],
                    currentIndex: -1,
                    isLoop: false,
                    playedCount: 0
                },
                speaking: {
                    audio: null,
                    playlist: [],
                    currentIndex: -1,
                    isLoop: false,
                    playedCount: 0
                }
            };
            
            // 初始化音频播放器
            window.initAudioPlayer = function(type) {
                var player = window.audioPlayers[type];
                if (!player.audio) {
                    player.audio = new Audio();
                    player.audio.volume = 0.8;
                    
                    player.audio.addEventListener('timeupdate', function() {
                        window.updateAudioProgress(type);
                    });
                    
                    player.audio.addEventListener('ended', function() {
                        if (player.isLoop) {
                            player.audio.currentTime = 0;
                            player.audio.play();
                        } else {
                            window.playNextAudio(type);
                        }
                    });
                    
                    player.audio.addEventListener('loadedmetadata', function() {
                        window.updateAudioDuration(type);
                    });
                }
            };
            
            // 加载音频列表
            window.loadAudioList = function(type) {
                var container = document.getElementById(type + '-list');
                var countEl = document.getElementById(type + '-count');
                
                if (!container) return;
                
                // 真实音频数据
                var audioFiles = [];
                
                if (type === 'listening') {
                    audioFiles = [
                        { name: '2014年3月听力', file: 'audio/听力/1-201403(1).mp3' },
                        { name: '2014年9月听力', file: 'audio/听力/2-  2014年9月.mp3' },
                        { name: '2015年3月听力', file: 'audio/听力/3-(2015年3月).mp3' },
                        { name: '2015年9月听力', file: 'audio/听力/4-(2015年9月).mp3' },
                        { name: '2014年高考湖北卷听力', file: 'audio/听力/5 2014年高考湖北卷听力（.mp3' },
                        { name: '2016年全国卷I', file: 'audio/听力/6-2016年全国卷I.mp3' },
                        { name: '2016年全国卷Ⅱ', file: 'audio/听力/7-2016年全国卷Ⅱ.mp3' },
                        { name: '2016浙江卷10月', file: 'audio/听力/8-2016浙江卷10月.mp3' },
                        { name: '2016年3月全国二级', file: 'audio/听力/9-（2016年3月全国二级）.mp3' },
                        { name: '2016年9月全国二级', file: 'audio/听力/10-（16年9月全国二级）.mp3' },
                        { name: '2017年全国1卷', file: 'audio/听力/听力训练11 全国1卷(1).mp3' },
                        { name: '2017年全国2卷', file: 'audio/听力/听力训练12 （2017年全国2卷）.mp3' },
                        { name: '2017年浙江卷', file: 'audio/听力/听力训练13（浙江卷）.mp3' },
                        { name: '2017年北京卷', file: 'audio/听力/听力训练14（北京卷）.mp3' },
                        { name: '2018年听力(15)', file: 'audio/听力/2018(15)(听力).mp3' },
                        { name: '2018年听力(16)', file: 'audio/听力/2018年（16）.mp3' },
                        { name: '2018年听力(17)', file: 'audio/听力/2018年（17）.mp3' },
                        { name: '2018年听力(18)', file: 'audio/听力/2018年（18）.mp3' },
                        { name: '2018年听力(19)', file: 'audio/听力/2018（19）.mp3' },
                        { name: '2019年3月贵州高考', file: 'audio/听力/21--2019年3月贵州高考听力音频(1).mp3' },
                        { name: '2019年全国I卷', file: 'audio/听力/22-2019年全国Ⅰ卷（主播：男Kristopher Chung和女Tushka Bergen）.mp3' },
                        { name: '2019年全国II卷III卷', file: 'audio/听力/23 2019年全国II卷Ⅲ卷（主播：男Kristopher Chung和女Tushka Bergen）(1).mp3' },
                        { name: '2019年浙江卷', file: 'audio/听力/24  2019年浙江卷（音频）.mp3' },
                        { name: '2019年9月PETS2级', file: 'audio/听力/20   2019年9月PETS2级听力音频(1).mp3' },
                        { name: '2020年9月PETS2', file: 'audio/听力/24-2020年9月26日PETS2英语听力音频(1).mp3' },
                        { name: '2020年全国II卷III卷', file: 'audio/听力/25-2020年全国II卷Ⅲ卷(1).mp3' },
                        { name: '2020年高考全国卷第一套', file: 'audio/听力/26-2020年高考全国卷英语听力试题 第一套卷：适用河南、山西(1).mp3' },
                        { name: '2020年山东新高考(第二次)', file: 'audio/听力/27-2020年1月8日山东新高考英语听力真题音频（第二次）(1).mp3' },
                        { name: '2020年山东卷', file: 'audio/听力/28-2020年山东卷-高考英语听力真题（含MP3）(1).mp3' },
                        { name: '2021年全国甲乙卷', file: 'audio/听力/听力训练29 2021年英语全国甲、乙卷听力(1).mp3' },
                        { name: '2025年全国二卷', file: 'audio/听力/听力训练51（2025年全国二卷）(2).mp3' }
                    ];
                } else if (type === 'speaking') {
                    audioFiles = [
                        { name: '语境 1', file: 'audio/口语/大一轮复习讲义（话题版）语境 1(1) (1).mp3' },
                        { name: '语境 3', file: 'audio/口语/大一轮复习讲义（话题版）语境 3(1) (1).mp3' },
                        { name: '语境 4', file: 'audio/口语/大一轮复习讲义（话题版）语境 4(1).mp3' },
                        { name: '语境 5', file: 'audio/口语/大一轮复习讲义（话题版）语境 5(1).mp3' },
                        { name: '语境 6', file: 'audio/口语/大一轮复习讲义（话题版）语境 6(1).mp3' },
                        { name: '语境 7', file: 'audio/口语/大一轮复习讲义（话题版）语境 7(1).mp3' },
                        { name: '语境 8', file: 'audio/口语/大一轮复习讲义（话题版）语境 8(1).mp3' },
                        { name: '语境 9', file: 'audio/口语/大一轮复习讲义（话题版）语境 9(1).mp3' },
                        { name: '语境 10', file: 'audio/口语/大一轮复习讲义（话题版）语境 10(1).mp3' },
                        { name: '语境 33', file: 'audio/口语/大一轮复习讲义（话题版）语境 33(1) (1).mp3' },
                        { name: '语境 34', file: 'audio/口语/大一轮复习讲义（话题版）语境 34(1) (1).mp3' }
                    ];
                }
                
                if (countEl) countEl.textContent = audioFiles.length;
                
                var html = '';
                audioFiles.forEach(function(audio, idx) {
                    html += '<div class="audio-card-premium" data-type="' + type + '" data-index="' + idx + '" data-name="' + audio.name + '" data-file="' + audio.file + '">';
                    html += '<div class="audio-card-icon">🎵</div>';
                    html += '<div class="audio-card-info">';
                    html += '<div class="audio-card-title">' + audio.name + '</div>';
                    html += '<div class="audio-card-meta">点击播放</div>';
                    html += '</div>';
                    html += '<button class="audio-add-btn" data-type="' + type + '" data-name="' + audio.name + '" data-file="' + audio.file + '" title="添加到播放列表">+</button>';
                    html += '</div>';
                });
                container.innerHTML = html;
            };
            
            // 播放音频
            window.playAudio = function(type, file, name) {
                var player = window.audioPlayers[type];
                window.initAudioPlayer(type);
                
                var playerEl = document.getElementById(type + '-player');
                var titleEl = document.getElementById(type + '-player-title');
                
                if (playerEl) playerEl.style.display = 'block';
                if (titleEl) titleEl.textContent = name;
                
                player.audio.src = file;
                player.audio.play();
                
                // 更新播放按钮
                var playBtn = document.getElementById(type + '-play-btn');
                if (playBtn) playBtn.textContent = '⏸';
                
                // 更新播放计数
                player.playedCount++;
                var playedEl = document.getElementById(type + '-played');
                if (playedEl) playedEl.textContent = player.playedCount;
            };
            
            // 更新进度条
            window.updateAudioProgress = function(type) {
                var player = window.audioPlayers[type];
                if (!player.audio) return;
                
                var progressSlider = document.getElementById(type + '-progress-slider');
                var currentTimeEl = document.getElementById(type + '-current-time');
                
                var progress = (player.audio.currentTime / player.audio.duration) * 100;
                if (progressSlider) progressSlider.value = progress || 0;
                
                if (currentTimeEl) {
                    currentTimeEl.textContent = window.formatTime(player.audio.currentTime);
                }
            };
            
            // 更新时长
            window.updateAudioDuration = function(type) {
                var player = window.audioPlayers[type];
                if (!player.audio) return;
                
                var durationEl = document.getElementById(type + '-duration');
                if (durationEl) {
                    durationEl.textContent = window.formatTime(player.audio.duration);
                }
            };
            
            // 格式化时间
            window.formatTime = function(seconds) {
                if (isNaN(seconds)) return '0:00';
                var mins = Math.floor(seconds / 60);
                var secs = Math.floor(seconds % 60);
                return mins + ':' + (secs < 10 ? '0' : '') + secs;
            };
            
            // 播放/暂停
            window.togglePlay = function(type) {
                var player = window.audioPlayers[type];
                if (!player.audio || !player.audio.src) return;
                
                var playBtn = document.getElementById(type + '-play-btn');
                
                if (player.audio.paused) {
                    player.audio.play();
                    if (playBtn) playBtn.textContent = '⏸';
                } else {
                    player.audio.pause();
                    if (playBtn) playBtn.textContent = '▶';
                }
            };
            
            // 上一个
            window.playPrevAudio = function(type) {
                var player = window.audioPlayers[type];
                if (player.playlist.length === 0) return;
                
                player.currentIndex--;
                if (player.currentIndex < 0) {
                    player.currentIndex = player.playlist.length - 1;
                }
                
                var item = player.playlist[player.currentIndex];
                window.playAudio(type, item.file, item.name);
                window.updatePlaylistUI(type);
            };
            
            // 下一个
            window.playNextAudio = function(type) {
                var player = window.audioPlayers[type];
                if (player.playlist.length === 0) return;
                
                player.currentIndex++;
                if (player.currentIndex >= player.playlist.length) {
                    player.currentIndex = 0;
                }
                
                var item = player.playlist[player.currentIndex];
                window.playAudio(type, item.file, item.name);
                window.updatePlaylistUI(type);
            };
            
            // 切换循环
            window.toggleLoop = function(type) {
                var player = window.audioPlayers[type];
                player.isLoop = !player.isLoop;
                
                var loopBtn = document.getElementById(type + '-loop-btn');
                if (loopBtn) {
                    loopBtn.classList.toggle('active', player.isLoop);
                }
            };
            
            // 添加到播放列表
            window.addToPlaylist = function(type, name, file) {
                var player = window.audioPlayers[type];
                
                // 检查是否已存在
                var exists = player.playlist.some(function(item) {
                    return item.file === file;
                });
                
                if (!exists) {
                    player.playlist.push({ name: name, file: file });
                    window.updatePlaylistUI(type);
                }
            };
            
            // 从播放列表移除
            window.removeFromPlaylist = function(type, index) {
                var player = window.audioPlayers[type];
                player.playlist.splice(index, 1);
                
                if (player.currentIndex >= index && player.currentIndex > 0) {
                    player.currentIndex--;
                }
                
                window.updatePlaylistUI(type);
            };
            
            // 更新播放列表UI
            window.updatePlaylistUI = function(type) {
                var player = window.audioPlayers[type];
                var container = document.getElementById(type + '-playlist');
                var countEl = document.getElementById(type + '-playlist-count');
                
                if (countEl) countEl.textContent = '(' + player.playlist.length + ')';
                
                if (!container) return;
                
                if (player.playlist.length === 0) {
                    container.innerHTML = '<div class="playlist-empty">播放列表为空</div>';
                    return;
                }
                
                var html = '';
                player.playlist.forEach(function(item, idx) {
                    var isActive = idx === player.currentIndex;
                    html += '<div class="playlist-item' + (isActive ? ' active' : '') + '" data-type="' + type + '" data-index="' + idx + '">';
                    html += '<span class="playlist-item-title">' + item.name + '</span>';
                    html += '<button class="playlist-item-remove" data-type="' + type + '" data-index="' + idx + '">✕</button>';
                    html += '</div>';
                });
                container.innerHTML = html;
            };
            
            // 音频页面点击事件
            document.addEventListener('click', function(e) {
                // 音频卡片点击
                if (e.target.closest('.audio-card-premium')) {
                    var card = e.target.closest('.audio-card-premium');
                    var type = card.dataset.type;
                    var name = card.dataset.name;
                    var file = card.dataset.file;
                    window.playAudio(type, file, name);
                }
                
                // 添加到播放列表
                if (e.target.closest('.audio-add-btn')) {
                    var btn = e.target.closest('.audio-add-btn');
                    var type = btn.dataset.type;
                    var name = btn.dataset.name;
                    var file = btn.dataset.file;
                    window.addToPlaylist(type, name, file);
                    e.stopPropagation();
                }
                
                // 播放列表项点击
                if (e.target.closest('.playlist-item') && !e.target.closest('.playlist-item-remove')) {
                    var item = e.target.closest('.playlist-item');
                    var type = item.dataset.type;
                    var index = parseInt(item.dataset.index);
                    var player = window.audioPlayers[type];
                    
                    player.currentIndex = index;
                    var audioItem = player.playlist[index];
                    window.playAudio(type, audioItem.file, audioItem.name);
                    window.updatePlaylistUI(type);
                }
                
                // 从播放列表移除
                if (e.target.closest('.playlist-item-remove')) {
                    var btn = e.target.closest('.playlist-item-remove');
                    var type = btn.dataset.type;
                    var index = parseInt(btn.dataset.index);
                    window.removeFromPlaylist(type, index);
                }
                
                // 播放控制按钮
                if (e.target.closest('[id$="-play-btn"]')) {
                    var btn = e.target.closest('[id$="-play-btn"]');
                    var type = btn.id.replace('-play-btn', '');
                    window.togglePlay(type);
                }
                
                if (e.target.closest('[id$="-prev-btn"]')) {
                    var btn = e.target.closest('[id$="-prev-btn"]');
                    var type = btn.id.replace('-prev-btn', '');
                    window.playPrevAudio(type);
                }
                
                if (e.target.closest('[id$="-next-btn"]')) {
                    var btn = e.target.closest('[id$="-next-btn"]');
                    var type = btn.id.replace('-next-btn', '');
                    window.playNextAudio(type);
                }
                
                if (e.target.closest('[id$="-loop-btn"]')) {
                    var btn = e.target.closest('[id$="-loop-btn"]');
                    var type = btn.id.replace('-loop-btn', '');
                    window.toggleLoop(type);
                }
            });
            
            // 音频控制输入事件
            document.addEventListener('input', function(e) {
                // 进度条
                if (e.target.closest('[id$="-progress-slider"]')) {
                    var slider = e.target.closest('[id$="-progress-slider"]');
                    var type = slider.id.replace('-progress-slider', '');
                    var player = window.audioPlayers[type];
                    
                    if (player.audio && player.audio.duration) {
                        var time = (slider.value / 100) * player.audio.duration;
                        player.audio.currentTime = time;
                    }
                }
                
                // 音量
                if (e.target.closest('[id$="-volume"]')) {
                    var slider = e.target.closest('[id$="-volume"]');
                    var type = slider.id.replace('-volume', '');
                    var player = window.audioPlayers[type];
                    
                    if (player.audio) {
                        player.audio.volume = slider.value / 100;
                    }
                }
            });
            
            // 倍速选择
            document.addEventListener('change', function(e) {
                if (e.target.closest('[id$="-speed"]')) {
                    var select = e.target.closest('[id$="-speed"]');
                    var type = select.id.replace('-speed', '');
                    var player = window.audioPlayers[type];
                    
                    if (player.audio) {
                        player.audio.playbackRate = parseFloat(select.value);
                    }
                }
            });
            
            // 记忆卡牌功能
            window.memoryGame = {
                difficulty: 'easy',
                cards: [],
                flippedCards: [],
                matchedPairs: 0,
                moves: 0,
                time: 0,
                timer: null,
                isPlaying: false,
                gamesPlayed: 0,
                bestTime: null
            };
            
            // 开始记忆游戏
            window.startMemoryGame = function() {
                var game = window.memoryGame;
                game.isPlaying = true;
                game.flippedCards = [];
                game.matchedPairs = 0;
                game.moves = 0;
                game.time = 0;
                
                // 隐藏开始屏幕，显示游戏区域
                var startScreen = document.getElementById('memory-start-screen');
                var gameArea = document.getElementById('memory-game-area');
                if (startScreen) startScreen.style.display = 'none';
                if (gameArea) gameArea.style.display = 'block';
                
                // 生成卡片
                window.generateMemoryCards();
                
                // 开始计时
                if (game.timer) clearInterval(game.timer);
                game.timer = setInterval(function() {
                    game.time++;
                    var timeEl = document.getElementById('memory-time');
                    if (timeEl) timeEl.textContent = game.time;
                }, 1000);
                
                // 更新统计
                var movesEl = document.getElementById('memory-moves');
                var pairsEl = document.getElementById('memory-pairs');
                if (movesEl) movesEl.textContent = '0';
                if (pairsEl) pairsEl.textContent = '0';
            };
            
            // 生成记忆卡片
            window.generateMemoryCards = function() {
                var game = window.memoryGame;
                var grid = document.getElementById('memory-grid');
                if (!grid) return;
                
                // 根据难度确定卡片数量
                var pairs = game.difficulty === 'easy' ? 8 : (game.difficulty === 'medium' ? 18 : 32);
                var cols = game.difficulty === 'easy' ? 4 : (game.difficulty === 'medium' ? 6 : 8);
                
                // 从单词库中随机选择单词
                var words = vocabulary3500.words.slice().sort(function() { return Math.random() - 0.5; }).slice(0, pairs);
                
                // 创建卡片对
                game.cards = [];
                words.forEach(function(word, idx) {
                    // 单词卡
                    game.cards.push({
                        id: idx * 2,
                        pairId: idx,
                        type: 'word',
                        content: word.word,
                        matched: false
                    });
                    // 释义卡
                    game.cards.push({
                        id: idx * 2 + 1,
                        pairId: idx,
                        type: 'meaning',
                        content: word.meaning,
                        matched: false
                    });
                });
                
                // 打乱卡片
                game.cards.sort(function() { return Math.random() - 0.5; });
                
                // 设置网格样式
                grid.style.gridTemplateColumns = 'repeat(' + cols + ', 1fr)';
                
                // 渲染卡片
                var html = '';
                game.cards.forEach(function(card) {
                    html += '<div class="memory-card" data-id="' + card.id + '" data-pair="' + card.pairId + '">';
                    html += '<div class="memory-card-inner">';
                    html += '<div class="memory-card-front">?</div>';
                    html += '<div class="memory-card-back">' + card.content + '</div>';
                    html += '</div>';
                    html += '</div>';
                });
                grid.innerHTML = html;
            };
            
            // 翻转卡片
            window.flipMemoryCard = function(cardEl) {
                var game = window.memoryGame;
                
                if (!game.isPlaying) return;
                if (cardEl.classList.contains('flipped') || cardEl.classList.contains('matched')) return;
                if (game.flippedCards.length >= 2) return;
                
                cardEl.classList.add('flipped');
                var cardId = parseInt(cardEl.dataset.id);
                var card = game.cards.find(function(c) { return c.id === cardId; });
                
                game.flippedCards.push({ el: cardEl, card: card });
                
                if (game.flippedCards.length === 2) {
                    game.moves++;
                    var movesEl = document.getElementById('memory-moves');
                    if (movesEl) movesEl.textContent = game.moves;
                    
                    window.checkMemoryMatch();
                }
            };
            
            // 检查匹配
            window.checkMemoryMatch = function() {
                var game = window.memoryGame;
                var first = game.flippedCards[0];
                var second = game.flippedCards[1];
                
                if (first.card.pairId === second.card.pairId && first.card.type !== second.card.type) {
                    // 匹配成功
                    first.card.matched = true;
                    second.card.matched = true;
                    first.el.classList.add('matched');
                    second.el.classList.add('matched');
                    
                    game.matchedPairs++;
                    var pairsEl = document.getElementById('memory-pairs');
                    if (pairsEl) pairsEl.textContent = game.matchedPairs;
                    
                    game.flippedCards = [];
                    
                    // 检查游戏是否结束
                    var totalPairs = game.difficulty === 'easy' ? 8 : (game.difficulty === 'medium' ? 18 : 32);
                    if (game.matchedPairs === totalPairs) {
                        window.endMemoryGame();
                    }
                } else {
                    // 匹配失败，延迟翻回
                    setTimeout(function() {
                        first.el.classList.remove('flipped');
                        second.el.classList.remove('flipped');
                        game.flippedCards = [];
                    }, 800);
                }
            };
            
            // 结束游戏
            window.endMemoryGame = function() {
                var game = window.memoryGame;
                game.isPlaying = false;
                
                if (game.timer) {
                    clearInterval(game.timer);
                    game.timer = null;
                }
                
                game.gamesPlayed++;
                
                // 更新最佳时间
                if (!game.bestTime || game.time < game.bestTime) {
                    game.bestTime = game.time;
                }
                
                // 更新统计显示
                var bestTimeEl = document.getElementById('memory-best-time');
                var gamesEl = document.getElementById('memory-games');
                if (bestTimeEl) bestTimeEl.textContent = game.bestTime + 's';
                if (gamesEl) gamesEl.textContent = game.gamesPlayed;
                
                // 显示完成弹窗
                setTimeout(function() {
                    alert('🎉 恭喜完成！\n用时：' + game.time + ' 秒\n步数：' + game.moves);
                }, 300);
            };
            
            // 重置游戏
            window.resetMemoryGame = function() {
                var game = window.memoryGame;
                game.isPlaying = false;
                
                if (game.timer) {
                    clearInterval(game.timer);
                    game.timer = null;
                }
                
                var startScreen = document.getElementById('memory-start-screen');
                var gameArea = document.getElementById('memory-game-area');
                if (startScreen) startScreen.style.display = 'flex';
                if (gameArea) gameArea.style.display = 'none';
            };
            
            // 记忆卡牌点击事件
            document.addEventListener('click', function(e) {
                var memoryPage = document.getElementById('page-memory-cards');
                if (!memoryPage || !memoryPage.classList.contains('active')) return;
                
                // 难度选择
                if (e.target.closest('.difficulty-tab')) {
                    var btn = e.target.closest('.difficulty-tab');
                    document.querySelectorAll('.difficulty-tab').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    window.memoryGame.difficulty = btn.dataset.difficulty;
                }
                
                // 开始游戏
                if (e.target.closest('#start-memory-btn')) {
                    window.startMemoryGame();
                }
                
                // 翻转卡片
                if (e.target.closest('.memory-card')) {
                    var card = e.target.closest('.memory-card');
                    window.flipMemoryCard(card);
                }
            });
            
            // 打字游戏功能
            window.typingGame = {
                mode: 'normal',
                currentWord: '',
                wordsTyped: 0,
                correctChars: 0,
                totalChars: 0,
                score: 0,
                time: 60,
                timer: null,
                isPlaying: false,
                gamesPlayed: 0,
                bestWpm: null,
                wordList: []
            };
            
            // 开始打字游戏
            window.startTypingGame = function() {
                var game = window.typingGame;
                game.isPlaying = true;
                game.wordsTyped = 0;
                game.correctChars = 0;
                game.totalChars = 0;
                game.score = 0;
                game.time = game.mode === 'zen' ? 9999 : 60;
                
                // 隐藏开始屏幕，显示游戏区域
                var startScreen = document.getElementById('typing-start-screen');
                var gameArea = document.getElementById('typing-game-area');
                if (startScreen) startScreen.style.display = 'none';
                if (gameArea) gameArea.style.display = 'block';
                
                // 准备单词列表
                game.wordList = vocabulary3500.words.slice().sort(function() { return Math.random() - 0.5; });
                
                // 显示第一个单词
                window.showNextTypingWord();
                
                // 聚焦输入框
                var input = document.getElementById('typing-input');
                if (input) {
                    input.value = '';
                    input.disabled = false;
                    input.focus();
                }
                
                // 开始计时
                if (game.timer) clearInterval(game.timer);
                game.timer = setInterval(function() {
                    game.time--;
                    var timeEl = document.getElementById('typing-time');
                    if (timeEl) timeEl.textContent = game.time;
                    
                    // 更新进度条
                    var progressFill = document.getElementById('typing-progress-fill');
                    if (progressFill) {
                        var progress = ((60 - game.time) / 60) * 100;
                        progressFill.style.width = progress + '%';
                    }
                    
                    if (game.time <= 0 && game.mode !== 'zen') {
                        window.endTypingGame();
                    }
                }, 1000);
                
                // 更新统计显示
                window.updateTypingStats();
            };
            
            // 显示下一个单词
            window.showNextTypingWord = function() {
                var game = window.typingGame;
                
                if (game.wordList.length === 0) {
                    game.wordList = vocabulary3500.words.slice().sort(function() { return Math.random() - 0.5; });
                }
                
                var wordObj = game.wordList.pop();
                game.currentWord = wordObj.word;
                game.currentMeaning = wordObj.meaning;
                
                var display = document.getElementById('typing-word-display');
                if (display) {
                    display.innerHTML = '<span class="word-remaining">' + game.currentWord + '</span>';
                }
                
                // 显示释义
                var meaningEl = document.getElementById('typing-meaning-display');
                if (meaningEl) {
                    meaningEl.textContent = '';
                    meaningEl.style.display = 'none';
                }
                
                var input = document.getElementById('typing-input');
                if (input) input.value = '';
            };
            
            // 处理输入（仅更新显示，不判断）
            window.handleTypingInput = function() {
                var game = window.typingGame;
                if (!game.isPlaying) return;
                
                var input = document.getElementById('typing-input');
                if (!input) return;
                
                var typed = input.value;
                var word = game.currentWord;
                
                // 更新显示
                var display = document.getElementById('typing-word-display');
                if (display) {
                    var typedPart = typed;
                    var remainingPart = word.substring(typed.length);
                    
                    // 检查是否正确
                    var isCorrect = word.startsWith(typed);
                    
                    var html = '<span class="word-typed';
                    if (!isCorrect) html += ' error';
                    html += '">' + typedPart + '</span>';
                    html += '<span class="word-remaining">' + remainingPart + '</span>';
                    display.innerHTML = html;
                }
            };
            
            // 提交答案（按Enter后判断）
            window.submitTypingAnswer = function() {
                var game = window.typingGame;
                if (!game.isPlaying) return;
                
                var input = document.getElementById('typing-input');
                if (!input) return;
                
                var typed = input.value.trim();
                var word = game.currentWord;
                var meaning = game.currentMeaning;
                
                // 显示释义
                var meaningEl = document.getElementById('typing-meaning-display');
                if (meaningEl) {
                    meaningEl.textContent = meaning;
                    meaningEl.style.display = 'block';
                }
                
                // 判断是否正确
                var isCorrect = typed.toLowerCase() === word.toLowerCase();
                
                game.totalChars += typed.length;
                
                if (isCorrect) {
                    game.wordsTyped++;
                    game.correctChars += word.length;
                    game.score += word.length * 10;
                    
                    // 困难模式额外加分
                    if (game.mode === 'hard') {
                        game.score += word.length * 5;
                    }
                    
                    // 显示正确提示
                    var display = document.getElementById('typing-word-display');
                    if (display) {
                        display.innerHTML = '<span class="word-typed correct">' + word + '</span> ✅';
                    }
                } else {
                    // 显示正确答案
                    var display = document.getElementById('typing-word-display');
                    if (display) {
                        display.innerHTML = '<span class="word-typed error">' + typed + '</span> → <span class="correct-answer">' + word + '</span> ❌';
                    }
                }
                
                window.updateTypingStats();
                
                // 延迟后显示下一个单词
                setTimeout(function() {
                    window.showNextTypingWord();
                    var inputEl = document.getElementById('typing-input');
                    if (inputEl) inputEl.focus();
                }, 1000);
            };
            
            // 更新统计
            window.updateTypingStats = function() {
                var game = window.typingGame;
                
                var scoreEl = document.getElementById('typing-score');
                var wpmEl = document.getElementById('typing-wpm');
                var accuracyEl = document.getElementById('typing-accuracy');
                
                if (scoreEl) scoreEl.textContent = game.score;
                
                // 计算WPM
                var elapsedMinutes = (60 - game.time) / 60;
                var wpm = elapsedMinutes > 0 ? Math.round(game.wordsTyped / elapsedMinutes) : 0;
                if (wpmEl) wpmEl.textContent = wpm;
                
                // 计算准确率
                var accuracy = game.totalChars > 0 ? Math.round((game.correctChars / game.totalChars) * 100) : 100;
                if (accuracyEl) accuracyEl.textContent = accuracy + '%';
            };
            
            // 结束游戏
            window.endTypingGame = function() {
                var game = window.typingGame;
                game.isPlaying = false;
                
                if (game.timer) {
                    clearInterval(game.timer);
                    game.timer = null;
                }
                
                // 禁用输入
                var input = document.getElementById('typing-input');
                if (input) input.disabled = true;
                
                game.gamesPlayed++;
                
                // 计算最终WPM
                var finalWpm = Math.round(game.wordsTyped);
                
                // 更新最佳WPM
                if (!game.bestWpm || finalWpm > game.bestWpm) {
                    game.bestWpm = finalWpm;
                }
                
                // 更新统计显示
                var bestWpmEl = document.getElementById('typing-best-wpm');
                var gamesEl = document.getElementById('typing-games');
                if (bestWpmEl) bestWpmEl.textContent = game.bestWpm;
                if (gamesEl) gamesEl.textContent = game.gamesPlayed;
                
                // 显示结果
                setTimeout(function() {
                    alert('🎉 游戏结束！\n分数：' + game.score + '\n单词数：' + game.wordsTyped + '\nWPM：' + finalWpm);
                }, 300);
            };
            
            // 重置游戏
            window.resetTypingGame = function() {
                var game = window.typingGame;
                game.isPlaying = false;
                
                if (game.timer) {
                    clearInterval(game.timer);
                    game.timer = null;
                }
                
                var startScreen = document.getElementById('typing-start-screen');
                var gameArea = document.getElementById('typing-game-area');
                if (startScreen) startScreen.style.display = 'flex';
                if (gameArea) gameArea.style.display = 'none';
            };
            
            // 打字游戏点击事件
            document.addEventListener('click', function(e) {
                var typingPage = document.getElementById('page-typing-game');
                if (!typingPage || !typingPage.classList.contains('active')) return;
                
                // 模式选择
                if (e.target.closest('.typing-mode-tab')) {
                    var btn = e.target.closest('.typing-mode-tab');
                    document.querySelectorAll('.typing-mode-tab').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    window.typingGame.mode = btn.dataset.mode;
                }
                
                // 开始游戏
                if (e.target.closest('#start-typing-btn')) {
                    window.startTypingGame();
                }
            });
            
            // 打字输入事件
            document.addEventListener('input', function(e) {
                if (e.target.id === 'typing-input') {
                    window.handleTypingInput();
                }
            });
            
            // 打字游戏键盘事件
            document.addEventListener('keydown', function(e) {
                if (e.target.id === 'typing-input' && e.key === 'Enter') {
                    e.preventDefault();
                    window.submitTypingAnswer();
                }
            });
            
            // 俗语谚语功能
            window.proverbsState = {
                currentTab: 'random',
                currentIndex: 0,
                favorites: [],
                searchQuery: '',
                page: 1,
                pageSize: 20
            };
            
            // 初始化俗语谚语
            window.initProverbs = function() {
                // 从localStorage加载收藏
                var savedFavs = localStorage.getItem('proverbs-favorites');
                if (savedFavs) {
                    window.proverbsState.favorites = JSON.parse(savedFavs);
                }
                
                window.updateProverbsStats();
                window.showRandomProverb();
            };
            
            // 更新统计
            window.updateProverbsStats = function() {
                var totalEl = document.getElementById('proverbs-total-count');
                var favEl = document.getElementById('proverbs-fav-count');
                
                if (totalEl && proverbsData) {
                    totalEl.textContent = proverbsData.proverbs.length;
                }
                if (favEl) {
                    favEl.textContent = window.proverbsState.favorites.length;
                }
            };
            
            // 显示随机俗语
            window.showRandomProverb = function() {
                if (!proverbsData) return;
                
                var proverbs = proverbsData.proverbs;
                var randomIndex = Math.floor(Math.random() * proverbs.length);
                var proverb = proverbs[randomIndex];
                
                var contentEl = document.getElementById('proverb-content');
                var translationEl = document.getElementById('proverb-translation');
                var favBtn = document.getElementById('proverb-fav-btn');
                
                if (contentEl) contentEl.textContent = proverb.english;
                if (translationEl) translationEl.textContent = proverb.chinese;
                
                // 更新收藏按钮状态
                if (favBtn) {
                    var isFav = window.proverbsState.favorites.includes(proverb.id);
                    favBtn.textContent = isFav ? '⭐ 已收藏' : '⭐ 收藏';
                    favBtn.classList.toggle('active', isFav);
                }
                
                window.proverbsState.currentIndex = randomIndex;
            };
            
            // 显示全部俗语
            window.showAllProverbs = function() {
                if (!proverbsData) return;
                
                var container = document.getElementById('proverbs-list');
                if (!container) return;
                
                var proverbs = proverbsData.proverbs;
                
                // 搜索过滤
                if (window.proverbsState.searchQuery) {
                    var query = window.proverbsState.searchQuery.toLowerCase();
                    proverbs = proverbs.filter(function(p) {
                        return p.english.toLowerCase().includes(query) || 
                               p.chinese.toLowerCase().includes(query);
                    });
                }
                
                // 分页
                var start = (window.proverbsState.page - 1) * window.proverbsState.pageSize;
                var end = start + window.proverbsState.pageSize;
                var pageProverbs = proverbs.slice(start, end);
                
                var html = '';
                pageProverbs.forEach(function(proverb) {
                    var isFav = window.proverbsState.favorites.includes(proverb.id);
                    html += '<div class="proverb-item" data-id="' + proverb.id + '">';
                    html += '<div class="proverb-item-english">' + proverb.english + '</div>';
                    html += '<div class="proverb-item-chinese">' + proverb.chinese + '</div>';
                    html += '<div class="proverb-item-actions">';
                    html += '<button class="proverb-item-btn speak-btn" data-id="' + proverb.id + '">🔊</button>';
                    html += '<button class="proverb-item-btn fav-btn' + (isFav ? ' active' : '') + '" data-id="' + proverb.id + '">' + (isFav ? '⭐' : '☆') + '</button>';
                    html += '</div>';
                    html += '</div>';
                });
                container.innerHTML = html;
                
                // 分页
                window.renderProverbsPagination(proverbs.length);
            };
            
            // 显示收藏
            window.showFavoritesProverbs = function() {
                var container = document.getElementById('proverbs-favorites-list');
                if (!container) return;
                
                if (window.proverbsState.favorites.length === 0) {
                    container.innerHTML = '<div class="proverbs-empty">还没有收藏任何俗语</div>';
                    return;
                }
                
                var html = '';
                window.proverbsState.favorites.forEach(function(id) {
                    var proverb = proverbsData.proverbs.find(function(p) { return p.id === id; });
                    if (proverb) {
                        html += '<div class="proverb-item" data-id="' + proverb.id + '">';
                        html += '<div class="proverb-item-english">' + proverb.english + '</div>';
                        html += '<div class="proverb-item-chinese">' + proverb.chinese + '</div>';
                        html += '<div class="proverb-item-actions">';
                        html += '<button class="proverb-item-btn speak-btn" data-id="' + proverb.id + '">🔊</button>';
                        html += '<button class="proverb-item-btn fav-btn active" data-id="' + proverb.id + '">⭐</button>';
                        html += '</div>';
                        html += '</div>';
                    }
                });
                container.innerHTML = html;
            };
            
            // 渲染分页
            window.renderProverbsPagination = function(total) {
                var container = document.getElementById('proverbs-pagination');
                if (!container) return;
                
                var totalPages = Math.ceil(total / window.proverbsState.pageSize);
                if (totalPages <= 1) {
                    container.innerHTML = '';
                    return;
                }
                
                var html = '';
                if (window.proverbsState.page > 1) {
                    html += '<button class="pagination-btn" data-page="' + (window.proverbsState.page - 1) + '">上一页</button>';
                }
                html += '<span class="pagination-info">第 ' + window.proverbsState.page + ' / ' + totalPages + ' 页</span>';
                if (window.proverbsState.page < totalPages) {
                    html += '<button class="pagination-btn" data-page="' + (window.proverbsState.page + 1) + '">下一页</button>';
                }
                container.innerHTML = html;
            };
            
            // 切换收藏
            window.toggleProverbFavorite = function(id) {
                var index = window.proverbsState.favorites.indexOf(id);
                if (index > -1) {
                    window.proverbsState.favorites.splice(index, 1);
                } else {
                    window.proverbsState.favorites.push(id);
                }
                
                localStorage.setItem('proverbs-favorites', JSON.stringify(window.proverbsState.favorites));
                window.updateProverbsStats();
            };
            
            // 播放俗语发音
            window.playProverbAudio = function(id) {
                var proverb = proverbsData.proverbs.find(function(p) { return p.id === id; });
                if (proverb && 'speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    var utterance = new SpeechSynthesisUtterance(proverb.english);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    speechSynthesis.speak(utterance);
                }
            };
            
            // 俗语谚语点击事件
            document.addEventListener('click', function(e) {
                var proverbsPage = document.getElementById('page-proverbs');
                if (!proverbsPage || !proverbsPage.classList.contains('active')) return;
                
                // 标签切换
                if (e.target.closest('.proverbs-tab')) {
                    var btn = e.target.closest('.proverbs-tab');
                    var tab = btn.dataset.tab;
                    
                    document.querySelectorAll('.proverbs-tab').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    
                    window.proverbsState.currentTab = tab;
                    window.proverbsState.page = 1;
                    
                    // 显示对应内容
                    document.getElementById('proverbs-random-content').style.display = tab === 'random' ? 'block' : 'none';
                    document.getElementById('proverbs-list-content').style.display = tab === 'all' ? 'block' : 'none';
                    document.getElementById('proverbs-favorites-content').style.display = tab === 'favorites' ? 'block' : 'none';
                    
                    if (tab === 'all') window.showAllProverbs();
                    if (tab === 'favorites') window.showFavoritesProverbs();
                }
                
                // 换一个
                if (e.target.closest('#proverbs-random-btn')) {
                    window.showRandomProverb();
                }
                
                // 发音
                if (e.target.closest('#proverb-audio-btn')) {
                    var proverb = proverbsData.proverbs[window.proverbsState.currentIndex];
                    if (proverb) window.playProverbAudio(proverb.id);
                }
                
                // 收藏（随机模式）
                if (e.target.closest('#proverb-fav-btn')) {
                    var proverb = proverbsData.proverbs[window.proverbsState.currentIndex];
                    if (proverb) {
                        window.toggleProverbFavorite(proverb.id);
                        var favBtn = document.getElementById('proverb-fav-btn');
                        var isFav = window.proverbsState.favorites.includes(proverb.id);
                        if (favBtn) {
                            favBtn.textContent = isFav ? '⭐ 已收藏' : '⭐ 收藏';
                            favBtn.classList.toggle('active', isFav);
                        }
                    }
                }
                
                // 列表项发音
                if (e.target.closest('.speak-btn')) {
                    var btn = e.target.closest('.speak-btn');
                    var id = parseInt(btn.dataset.id);
                    window.playProverbAudio(id);
                }
                
                // 列表项收藏
                if (e.target.closest('.fav-btn') && !e.target.closest('#proverb-fav-btn')) {
                    var btn = e.target.closest('.fav-btn');
                    var id = parseInt(btn.dataset.id);
                    window.toggleProverbFavorite(id);
                    
                    var isFav = window.proverbsState.favorites.includes(id);
                    btn.textContent = isFav ? '⭐' : '☆';
                    btn.classList.toggle('active', isFav);
                    
                    // 如果在收藏页面，刷新列表
                    if (window.proverbsState.currentTab === 'favorites') {
                        window.showFavoritesProverbs();
                    }
                }
                
                // 分页
                if (e.target.closest('.pagination-btn')) {
                    var btn = e.target.closest('.pagination-btn');
                    window.proverbsState.page = parseInt(btn.dataset.page);
                    window.showAllProverbs();
                }
            });
            
            // 俗语搜索
            document.addEventListener('input', function(e) {
                if (e.target.id === 'proverbs-search-input') {
                    window.proverbsState.searchQuery = e.target.value;
                    window.proverbsState.page = 1;
                    
                    if (window.proverbsState.currentTab === 'all') {
                        window.showAllProverbs();
                    }
                }
            });
            
            // 俗语谚语键盘事件
            document.addEventListener('keydown', function(e) {
                var proverbsPage = document.getElementById('page-proverbs');
                if (!proverbsPage || !proverbsPage.classList.contains('active')) return;
                
                if (e.key === 'Enter' && window.proverbsState.currentTab === 'random') {
                    window.showRandomProverb();
                }
            });
            
            // 短语功能
            window.phrasesState = {
                currentTab: 'random',
                currentIndex: 0,
                favorites: [],
                searchQuery: '',
                page: 1,
                pageSize: 20
            };
            
            // 初始化短语
            window.initPhrases = function() {
                var savedFavs = localStorage.getItem('phrases-favorites');
                if (savedFavs) {
                    window.phrasesState.favorites = JSON.parse(savedFavs);
                }
                
                window.updatePhrasesStats();
                window.showRandomPhrase();
            };
            
            // 更新统计
            window.updatePhrasesStats = function() {
                var totalEl = document.getElementById('phrases-total-count');
                var favEl = document.getElementById('phrases-fav-count');
                
                if (totalEl && phrasesData) {
                    totalEl.textContent = phrasesData.phrases.length;
                }
                if (favEl) {
                    favEl.textContent = window.phrasesState.favorites.length;
                }
            };
            
            // 显示随机短语
            window.showRandomPhrase = function() {
                if (!phrasesData) return;
                
                var phrases = phrasesData.phrases;
                var randomIndex = Math.floor(Math.random() * phrases.length);
                var phrase = phrases[randomIndex];
                
                var contentEl = document.getElementById('phrase-content');
                var translationEl = document.getElementById('phrase-translation');
                var favBtn = document.getElementById('phrase-fav-btn');
                
                if (contentEl) contentEl.textContent = phrase.english;
                if (translationEl) translationEl.textContent = phrase.chinese;
                
                if (favBtn) {
                    var isFav = window.phrasesState.favorites.includes(phrase.id);
                    favBtn.textContent = isFav ? '⭐ 已收藏' : '⭐ 收藏';
                    favBtn.classList.toggle('active', isFav);
                }
                
                window.phrasesState.currentIndex = randomIndex;
            };
            
            // 显示全部短语
            window.showAllPhrases = function() {
                if (!phrasesData) return;
                
                var container = document.getElementById('phrases-list');
                if (!container) return;
                
                var phrases = phrasesData.phrases;
                
                if (window.phrasesState.searchQuery) {
                    var query = window.phrasesState.searchQuery.toLowerCase();
                    phrases = phrases.filter(function(p) {
                        return p.english.toLowerCase().includes(query) || 
                               p.chinese.toLowerCase().includes(query);
                    });
                }
                
                var start = (window.phrasesState.page - 1) * window.phrasesState.pageSize;
                var end = start + window.phrasesState.pageSize;
                var pagePhrases = phrases.slice(start, end);
                
                var html = '';
                pagePhrases.forEach(function(phrase) {
                    var isFav = window.phrasesState.favorites.includes(phrase.id);
                    html += '<div class="phrase-item" data-id="' + phrase.id + '">';
                    html += '<div class="phrase-item-english">' + phrase.english + '</div>';
                    html += '<div class="phrase-item-chinese">' + phrase.chinese + '</div>';
                    html += '<div class="phrase-item-actions">';
                    html += '<button class="phrase-item-btn speak-btn" data-id="' + phrase.id + '">🔊</button>';
                    html += '<button class="phrase-item-btn fav-btn' + (isFav ? ' active' : '') + '" data-id="' + phrase.id + '">' + (isFav ? '⭐' : '☆') + '</button>';
                    html += '</div>';
                    html += '</div>';
                });
                container.innerHTML = html;
                
                window.renderPhrasesPagination(phrases.length);
            };
            
            // 显示收藏
            window.showFavoritesPhrases = function() {
                var container = document.getElementById('phrases-favorites-list');
                if (!container) return;
                
                if (window.phrasesState.favorites.length === 0) {
                    container.innerHTML = '<div class="phrases-empty">还没有收藏任何短语</div>';
                    return;
                }
                
                var html = '';
                window.phrasesState.favorites.forEach(function(id) {
                    var phrase = phrasesData.phrases.find(function(p) { return p.id === id; });
                    if (phrase) {
                        html += '<div class="phrase-item" data-id="' + phrase.id + '">';
                        html += '<div class="phrase-item-english">' + phrase.english + '</div>';
                        html += '<div class="phrase-item-chinese">' + phrase.chinese + '</div>';
                        html += '<div class="phrase-item-actions">';
                        html += '<button class="phrase-item-btn speak-btn" data-id="' + phrase.id + '">🔊</button>';
                        html += '<button class="phrase-item-btn fav-btn active" data-id="' + phrase.id + '">⭐</button>';
                        html += '</div>';
                        html += '</div>';
                    }
                });
                container.innerHTML = html;
            };
            
            // 渲染分页
            window.renderPhrasesPagination = function(total) {
                var container = document.getElementById('phrases-pagination');
                if (!container) return;
                
                var totalPages = Math.ceil(total / window.phrasesState.pageSize);
                if (totalPages <= 1) {
                    container.innerHTML = '';
                    return;
                }
                
                var html = '';
                if (window.phrasesState.page > 1) {
                    html += '<button class="pagination-btn" data-page="' + (window.phrasesState.page - 1) + '">上一页</button>';
                }
                html += '<span class="pagination-info">第 ' + window.phrasesState.page + ' / ' + totalPages + ' 页</span>';
                if (window.phrasesState.page < totalPages) {
                    html += '<button class="pagination-btn" data-page="' + (window.phrasesState.page + 1) + '">下一页</button>';
                }
                container.innerHTML = html;
            };
            
            // 切换收藏
            window.togglePhraseFavorite = function(id) {
                var index = window.phrasesState.favorites.indexOf(id);
                if (index > -1) {
                    window.phrasesState.favorites.splice(index, 1);
                } else {
                    window.phrasesState.favorites.push(id);
                }
                
                localStorage.setItem('phrases-favorites', JSON.stringify(window.phrasesState.favorites));
                window.updatePhrasesStats();
            };
            
            // 播放短语发音
            window.playPhraseAudio = function(id) {
                var phrase = phrasesData.phrases.find(function(p) { return p.id === id; });
                if (phrase && 'speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    var utterance = new SpeechSynthesisUtterance(phrase.english);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    speechSynthesis.speak(utterance);
                }
            };
            
            // 短语点击事件
            document.addEventListener('click', function(e) {
                var phrasesPage = document.getElementById('page-phrases');
                if (!phrasesPage || !phrasesPage.classList.contains('active')) return;
                
                // 标签切换
                if (e.target.closest('.phrases-tab')) {
                    var btn = e.target.closest('.phrases-tab');
                    var tab = btn.dataset.tab;
                    
                    document.querySelectorAll('.phrases-tab').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    
                    window.phrasesState.currentTab = tab;
                    window.phrasesState.page = 1;
                    
                    document.getElementById('phrases-random-content').style.display = tab === 'random' ? 'block' : 'none';
                    document.getElementById('phrases-list-content').style.display = tab === 'all' ? 'block' : 'none';
                    document.getElementById('phrases-favorites-content').style.display = tab === 'favorites' ? 'block' : 'none';
                    
                    if (tab === 'all') window.showAllPhrases();
                    if (tab === 'favorites') window.showFavoritesPhrases();
                }
                
                // 换一个
                if (e.target.closest('#phrases-random-btn')) {
                    window.showRandomPhrase();
                }
                
                // 发音
                if (e.target.closest('#phrase-audio-btn')) {
                    var phrase = phrasesData.phrases[window.phrasesState.currentIndex];
                    if (phrase) window.playPhraseAudio(phrase.id);
                }
                
                // 收藏（随机模式）
                if (e.target.closest('#phrase-fav-btn')) {
                    var phrase = phrasesData.phrases[window.phrasesState.currentIndex];
                    if (phrase) {
                        window.togglePhraseFavorite(phrase.id);
                        var favBtn = document.getElementById('phrase-fav-btn');
                        var isFav = window.phrasesState.favorites.includes(phrase.id);
                        if (favBtn) {
                            favBtn.textContent = isFav ? '⭐ 已收藏' : '⭐ 收藏';
                            favBtn.classList.toggle('active', isFav);
                        }
                    }
                }
                
                // 列表项发音
                if (e.target.closest('.phrase-item .speak-btn')) {
                    var btn = e.target.closest('.speak-btn');
                    var id = parseInt(btn.dataset.id);
                    console.log('Phrase speak btn clicked, id:', id);
                    window.playPhraseAudio(id);
                }
                
                // 列表项收藏
                if (e.target.closest('.phrase-item .fav-btn')) {
                    var btn = e.target.closest('.fav-btn');
                    var id = parseInt(btn.dataset.id);
                    window.togglePhraseFavorite(id);
                    
                    var isFav = window.phrasesState.favorites.includes(id);
                    btn.textContent = isFav ? '⭐' : '☆';
                    btn.classList.toggle('active', isFav);
                    
                    if (window.phrasesState.currentTab === 'favorites') {
                        window.showFavoritesPhrases();
                    }
                }
                
                // 分页
                if (e.target.closest('#phrases-pagination .pagination-btn')) {
                    var btn = e.target.closest('.pagination-btn');
                    window.phrasesState.page = parseInt(btn.dataset.page);
                    window.showAllPhrases();
                }
            });
            
            // 短语搜索
            document.addEventListener('input', function(e) {
                if (e.target.id === 'phrases-search-input') {
                    window.phrasesState.searchQuery = e.target.value;
                    window.phrasesState.page = 1;
                    
                    if (window.phrasesState.currentTab === 'all') {
                        window.showAllPhrases();
                    }
                }
            });
            
            // 短语键盘事件
            document.addEventListener('keydown', function(e) {
                var phrasesPage = document.getElementById('page-phrases');
                if (!phrasesPage || !phrasesPage.classList.contains('active')) return;
                
                if (e.key === 'Enter' && window.phrasesState.currentTab === 'random') {
                    window.showRandomPhrase();
                }
            });
            
            // 点击外部关闭手机端侧边栏
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768 && sidebar && sidebar.classList.contains('mobile-open')) {
                    if (!sidebar.contains(e.target) && mobileMenuBtn && !mobileMenuBtn.contains(e.target)) {
                        sidebar.classList.remove('mobile-open');
                    }
                }
            });
        });
    </script>
</body>
</html>